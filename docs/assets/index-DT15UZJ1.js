const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdf-DYQjO8b9.js","assets/pdf-lib-F-JeKLTy.js","assets/vendor-react-BP3aSIDx.js","assets/vendor-ui-B9lLo91n.js"])))=>i.map(i=>d[i]);
import{r as g,j as r,k as Lt,R as It,C as He,m as At,n as Ft,X as Bt,S as Dt,L as _t,I as $t,T as Gt,p as Ut,q as Ot,t as Vt}from"./vendor-react-BP3aSIDx.js";import{S as Ht,R as We,I as Wt,T as Xe,a as Xt,b as Ye,c as qe,P as Yt,C as Ze,V as qt,L as Qe,d as Je,e as Zt,f as Qt,g as Ke,h as Jt,i as Kt,O as et,j as es,k as tt,l as ts,m as st,D as rt,n as ss,o as ot,p as nt,q as rs,r as os,s as ns,t as as}from"./vendor-ui-B9lLo91n.js";import"./pdf-lib-F-JeKLTy.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();function he(e){const s=document.documentElement,t=window.matchMedia("(prefers-color-scheme: dark)").matches,o=e==="dark"||e==="system"&&t;s.classList.toggle("dark",o)}function is(){g.useEffect(()=>{const e=localStorage.getItem("theme")??"system";he(e);const s=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{const n=localStorage.getItem("theme")??"system";n==="system"&&he(n)};s.addEventListener("change",t);const o=n=>{if(n.key==="theme"){const a=n.newValue??"system";he(a)}};return window.addEventListener("storage",o),()=>{s.removeEventListener("change",t),window.removeEventListener("storage",o)}},[])}function at(e){var s,t,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var n=e.length;for(s=0;s<n;s++)e[s]&&(t=at(e[s]))&&(o&&(o+=" "),o+=t)}else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}function it(){for(var e,s,t=0,o="",n=arguments.length;t<n;t++)(e=arguments[t])&&(s=at(e))&&(o&&(o+=" "),o+=s);return o}const Fe=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,Be=it,lt=(e,s)=>t=>{var o;if(s?.variants==null)return Be(e,t?.class,t?.className);const{variants:n,defaultVariants:a}=s,l=Object.keys(n).map(m=>{const u=t?.[m],x=a?.[m];if(u===null)return null;const h=Fe(u)||Fe(x);return n[m][h]}),d=t&&Object.entries(t).reduce((m,u)=>{let[x,h]=u;return h===void 0||(m[x]=h),m},{}),c=s==null||(o=s.compoundVariants)===null||o===void 0?void 0:o.reduce((m,u)=>{let{class:x,className:h,...P}=u;return Object.entries(P).every(j=>{let[v,S]=j;return Array.isArray(S)?S.includes({...a,...d}[v]):{...a,...d}[v]===S})?[...m,x,h]:m},[]);return Be(e,l,c,t?.class,t?.className)},Ne="-",ls=e=>{const s=ds(e),{conflictingClassGroups:t,conflictingClassGroupModifiers:o}=e;return{getClassGroupId:l=>{const d=l.split(Ne);return d[0]===""&&d.length!==1&&d.shift(),ct(d,s)||cs(l)},getConflictingClassGroupIds:(l,d)=>{const c=t[l]||[];return d&&o[l]?[...c,...o[l]]:c}}},ct=(e,s)=>{if(e.length===0)return s.classGroupId;const t=e[0],o=s.nextPart.get(t),n=o?ct(e.slice(1),o):void 0;if(n)return n;if(s.validators.length===0)return;const a=e.join(Ne);return s.validators.find(({validator:l})=>l(a))?.classGroupId},De=/^\[(.+)\]$/,cs=e=>{if(De.test(e)){const s=De.exec(e)[1],t=s?.substring(0,s.indexOf(":"));if(t)return"arbitrary.."+t}},ds=e=>{const{theme:s,classGroups:t}=e,o={nextPart:new Map,validators:[]};for(const n in t)ve(t[n],o,n,s);return o},ve=(e,s,t,o)=>{e.forEach(n=>{if(typeof n=="string"){const a=n===""?s:_e(s,n);a.classGroupId=t;return}if(typeof n=="function"){if(us(n)){ve(n(o),s,t,o);return}s.validators.push({validator:n,classGroupId:t});return}Object.entries(n).forEach(([a,l])=>{ve(l,_e(s,a),t,o)})})},_e=(e,s)=>{let t=e;return s.split(Ne).forEach(o=>{t.nextPart.has(o)||t.nextPart.set(o,{nextPart:new Map,validators:[]}),t=t.nextPart.get(o)}),t},us=e=>e.isThemeGetter,ms=e=>{if(e<1)return{get:()=>{},set:()=>{}};let s=0,t=new Map,o=new Map;const n=(a,l)=>{t.set(a,l),s++,s>e&&(s=0,o=t,t=new Map)};return{get(a){let l=t.get(a);if(l!==void 0)return l;if((l=o.get(a))!==void 0)return n(a,l),l},set(a,l){t.has(a)?t.set(a,l):n(a,l)}}},ke="!",je=":",fs=je.length,ps=e=>{const{prefix:s,experimentalParseClassName:t}=e;let o=n=>{const a=[];let l=0,d=0,c=0,m;for(let j=0;j<n.length;j++){let v=n[j];if(l===0&&d===0){if(v===je){a.push(n.slice(c,j)),c=j+fs;continue}if(v==="/"){m=j;continue}}v==="["?l++:v==="]"?l--:v==="("?d++:v===")"&&d--}const u=a.length===0?n:n.substring(c),x=hs(u),h=x!==u,P=m&&m>c?m-c:void 0;return{modifiers:a,hasImportantModifier:h,baseClassName:x,maybePostfixModifierPosition:P}};if(s){const n=s+je,a=o;o=l=>l.startsWith(n)?a(l.substring(n.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:l,maybePostfixModifierPosition:void 0}}if(t){const n=o;o=a=>t({className:a,parseClassName:n})}return o},hs=e=>e.endsWith(ke)?e.substring(0,e.length-1):e.startsWith(ke)?e.substring(1):e,gs=e=>{const s=Object.fromEntries(e.orderSensitiveModifiers.map(o=>[o,!0]));return o=>{if(o.length<=1)return o;const n=[];let a=[];return o.forEach(l=>{l[0]==="["||s[l]?(n.push(...a.sort(),l),a=[]):a.push(l)}),n.push(...a.sort()),n}},xs=e=>({cache:ms(e.cacheSize),parseClassName:ps(e),sortModifiers:gs(e),...ls(e)}),bs=/\s+/,ys=(e,s)=>{const{parseClassName:t,getClassGroupId:o,getConflictingClassGroupIds:n,sortModifiers:a}=s,l=[],d=e.trim().split(bs);let c="";for(let m=d.length-1;m>=0;m-=1){const u=d[m],{isExternal:x,modifiers:h,hasImportantModifier:P,baseClassName:j,maybePostfixModifierPosition:v}=t(u);if(x){c=u+(c.length>0?" "+c:c);continue}let S=!!v,k=o(S?j.substring(0,v):j);if(!k){if(!S){c=u+(c.length>0?" "+c:c);continue}if(k=o(j),!k){c=u+(c.length>0?" "+c:c);continue}S=!1}const E=a(h).join(":"),b=P?E+ke:E,p=b+k;if(l.includes(p))continue;l.push(p);const M=n(k,S);for(let N=0;N<M.length;++N){const A=M[N];l.push(b+A)}c=u+(c.length>0?" "+c:c)}return c};function ws(){let e=0,s,t,o="";for(;e<arguments.length;)(s=arguments[e++])&&(t=dt(s))&&(o&&(o+=" "),o+=t);return o}const dt=e=>{if(typeof e=="string")return e;let s,t="";for(let o=0;o<e.length;o++)e[o]&&(s=dt(e[o]))&&(t&&(t+=" "),t+=s);return t};function vs(e,...s){let t,o,n,a=l;function l(c){const m=s.reduce((u,x)=>x(u),e());return t=xs(m),o=t.cache.get,n=t.cache.set,a=d,d(c)}function d(c){const m=o(c);if(m)return m;const u=ys(c,t);return n(c,u),u}return function(){return a(ws.apply(null,arguments))}}const B=e=>{const s=t=>t[e]||[];return s.isThemeGetter=!0,s},ut=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,mt=/^\((?:(\w[\w-]*):)?(.+)\)$/i,ks=/^\d+\/\d+$/,js=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ns=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Cs=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,Rs=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Ss=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Q=e=>ks.test(e),z=e=>!!e&&!Number.isNaN(Number(e)),q=e=>!!e&&Number.isInteger(Number(e)),ge=e=>e.endsWith("%")&&z(e.slice(0,-1)),Y=e=>js.test(e),Ps=()=>!0,zs=e=>Ns.test(e)&&!Cs.test(e),ft=()=>!1,Ms=e=>Rs.test(e),Es=e=>Ss.test(e),Ts=e=>!y(e)&&!w(e),Ls=e=>K(e,gt,ft),y=e=>ut.test(e),Z=e=>K(e,xt,zs),xe=e=>K(e,Ds,z),$e=e=>K(e,pt,ft),Is=e=>K(e,ht,Es),ce=e=>K(e,bt,Ms),w=e=>mt.test(e),te=e=>ee(e,xt),As=e=>ee(e,_s),Ge=e=>ee(e,pt),Fs=e=>ee(e,gt),Bs=e=>ee(e,ht),de=e=>ee(e,bt,!0),K=(e,s,t)=>{const o=ut.exec(e);return o?o[1]?s(o[1]):t(o[2]):!1},ee=(e,s,t=!1)=>{const o=mt.exec(e);return o?o[1]?s(o[1]):t:!1},pt=e=>e==="position"||e==="percentage",ht=e=>e==="image"||e==="url",gt=e=>e==="length"||e==="size"||e==="bg-size",xt=e=>e==="length",Ds=e=>e==="number",_s=e=>e==="family-name",bt=e=>e==="shadow",$s=()=>{const e=B("color"),s=B("font"),t=B("text"),o=B("font-weight"),n=B("tracking"),a=B("leading"),l=B("breakpoint"),d=B("container"),c=B("spacing"),m=B("radius"),u=B("shadow"),x=B("inset-shadow"),h=B("text-shadow"),P=B("drop-shadow"),j=B("blur"),v=B("perspective"),S=B("aspect"),k=B("ease"),E=B("animate"),b=()=>["auto","avoid","all","avoid-page","page","left","right","column"],p=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],M=()=>[...p(),w,y],N=()=>["auto","hidden","clip","visible","scroll"],A=()=>["auto","contain","none"],i=()=>[w,y,c],f=()=>[Q,"full","auto",...i()],L=()=>[q,"none","subgrid",w,y],F=()=>["auto",{span:["full",q,w,y]},q,w,y],U=()=>[q,"auto",w,y],$=()=>["auto","min","max","fr",w,y],R=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],V=()=>["start","end","center","stretch","center-safe","end-safe"],_=()=>["auto",...i()],X=()=>[Q,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...i()],C=()=>[e,w,y],oe=()=>[...p(),Ge,$e,{position:[w,y]}],Te=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Le=()=>["auto","cover","contain",Fs,Ls,{size:[w,y]}],fe=()=>[ge,te,Z],O=()=>["","none","full",m,w,y],H=()=>["",z,te,Z],ne=()=>["solid","dashed","dotted","double"],Ie=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],D=()=>[z,ge,Ge,$e],Ae=()=>["","none",j,w,y],ae=()=>["none",z,w,y],ie=()=>["none",z,w,y],pe=()=>[z,w,y],le=()=>[Q,"full",...i()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Y],breakpoint:[Y],color:[Ps],container:[Y],"drop-shadow":[Y],ease:["in","out","in-out"],font:[Ts],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Y],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Y],shadow:[Y],spacing:["px",z],text:[Y],"text-shadow":[Y],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Q,y,w,S]}],container:["container"],columns:[{columns:[z,y,w,d]}],"break-after":[{"break-after":b()}],"break-before":[{"break-before":b()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:M()}],overflow:[{overflow:N()}],"overflow-x":[{"overflow-x":N()}],"overflow-y":[{"overflow-y":N()}],overscroll:[{overscroll:A()}],"overscroll-x":[{"overscroll-x":A()}],"overscroll-y":[{"overscroll-y":A()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:f()}],"inset-x":[{"inset-x":f()}],"inset-y":[{"inset-y":f()}],start:[{start:f()}],end:[{end:f()}],top:[{top:f()}],right:[{right:f()}],bottom:[{bottom:f()}],left:[{left:f()}],visibility:["visible","invisible","collapse"],z:[{z:[q,"auto",w,y]}],basis:[{basis:[Q,"full","auto",d,...i()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[z,Q,"auto","initial","none",y]}],grow:[{grow:["",z,w,y]}],shrink:[{shrink:["",z,w,y]}],order:[{order:[q,"first","last","none",w,y]}],"grid-cols":[{"grid-cols":L()}],"col-start-end":[{col:F()}],"col-start":[{"col-start":U()}],"col-end":[{"col-end":U()}],"grid-rows":[{"grid-rows":L()}],"row-start-end":[{row:F()}],"row-start":[{"row-start":U()}],"row-end":[{"row-end":U()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":$()}],"auto-rows":[{"auto-rows":$()}],gap:[{gap:i()}],"gap-x":[{"gap-x":i()}],"gap-y":[{"gap-y":i()}],"justify-content":[{justify:[...R(),"normal"]}],"justify-items":[{"justify-items":[...V(),"normal"]}],"justify-self":[{"justify-self":["auto",...V()]}],"align-content":[{content:["normal",...R()]}],"align-items":[{items:[...V(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...V(),{baseline:["","last"]}]}],"place-content":[{"place-content":R()}],"place-items":[{"place-items":[...V(),"baseline"]}],"place-self":[{"place-self":["auto",...V()]}],p:[{p:i()}],px:[{px:i()}],py:[{py:i()}],ps:[{ps:i()}],pe:[{pe:i()}],pt:[{pt:i()}],pr:[{pr:i()}],pb:[{pb:i()}],pl:[{pl:i()}],m:[{m:_()}],mx:[{mx:_()}],my:[{my:_()}],ms:[{ms:_()}],me:[{me:_()}],mt:[{mt:_()}],mr:[{mr:_()}],mb:[{mb:_()}],ml:[{ml:_()}],"space-x":[{"space-x":i()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":i()}],"space-y-reverse":["space-y-reverse"],size:[{size:X()}],w:[{w:[d,"screen",...X()]}],"min-w":[{"min-w":[d,"screen","none",...X()]}],"max-w":[{"max-w":[d,"screen","none","prose",{screen:[l]},...X()]}],h:[{h:["screen","lh",...X()]}],"min-h":[{"min-h":["screen","lh","none",...X()]}],"max-h":[{"max-h":["screen","lh",...X()]}],"font-size":[{text:["base",t,te,Z]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[o,w,xe]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",ge,y]}],"font-family":[{font:[As,y,s]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,w,y]}],"line-clamp":[{"line-clamp":[z,"none",w,xe]}],leading:[{leading:[a,...i()]}],"list-image":[{"list-image":["none",w,y]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",w,y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:C()}],"text-color":[{text:C()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ne(),"wavy"]}],"text-decoration-thickness":[{decoration:[z,"from-font","auto",w,Z]}],"text-decoration-color":[{decoration:C()}],"underline-offset":[{"underline-offset":[z,"auto",w,y]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:i()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",w,y]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",w,y]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:oe()}],"bg-repeat":[{bg:Te()}],"bg-size":[{bg:Le()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},q,w,y],radial:["",w,y],conic:[q,w,y]},Bs,Is]}],"bg-color":[{bg:C()}],"gradient-from-pos":[{from:fe()}],"gradient-via-pos":[{via:fe()}],"gradient-to-pos":[{to:fe()}],"gradient-from":[{from:C()}],"gradient-via":[{via:C()}],"gradient-to":[{to:C()}],rounded:[{rounded:O()}],"rounded-s":[{"rounded-s":O()}],"rounded-e":[{"rounded-e":O()}],"rounded-t":[{"rounded-t":O()}],"rounded-r":[{"rounded-r":O()}],"rounded-b":[{"rounded-b":O()}],"rounded-l":[{"rounded-l":O()}],"rounded-ss":[{"rounded-ss":O()}],"rounded-se":[{"rounded-se":O()}],"rounded-ee":[{"rounded-ee":O()}],"rounded-es":[{"rounded-es":O()}],"rounded-tl":[{"rounded-tl":O()}],"rounded-tr":[{"rounded-tr":O()}],"rounded-br":[{"rounded-br":O()}],"rounded-bl":[{"rounded-bl":O()}],"border-w":[{border:H()}],"border-w-x":[{"border-x":H()}],"border-w-y":[{"border-y":H()}],"border-w-s":[{"border-s":H()}],"border-w-e":[{"border-e":H()}],"border-w-t":[{"border-t":H()}],"border-w-r":[{"border-r":H()}],"border-w-b":[{"border-b":H()}],"border-w-l":[{"border-l":H()}],"divide-x":[{"divide-x":H()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":H()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...ne(),"hidden","none"]}],"divide-style":[{divide:[...ne(),"hidden","none"]}],"border-color":[{border:C()}],"border-color-x":[{"border-x":C()}],"border-color-y":[{"border-y":C()}],"border-color-s":[{"border-s":C()}],"border-color-e":[{"border-e":C()}],"border-color-t":[{"border-t":C()}],"border-color-r":[{"border-r":C()}],"border-color-b":[{"border-b":C()}],"border-color-l":[{"border-l":C()}],"divide-color":[{divide:C()}],"outline-style":[{outline:[...ne(),"none","hidden"]}],"outline-offset":[{"outline-offset":[z,w,y]}],"outline-w":[{outline:["",z,te,Z]}],"outline-color":[{outline:C()}],shadow:[{shadow:["","none",u,de,ce]}],"shadow-color":[{shadow:C()}],"inset-shadow":[{"inset-shadow":["none",x,de,ce]}],"inset-shadow-color":[{"inset-shadow":C()}],"ring-w":[{ring:H()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:C()}],"ring-offset-w":[{"ring-offset":[z,Z]}],"ring-offset-color":[{"ring-offset":C()}],"inset-ring-w":[{"inset-ring":H()}],"inset-ring-color":[{"inset-ring":C()}],"text-shadow":[{"text-shadow":["none",h,de,ce]}],"text-shadow-color":[{"text-shadow":C()}],opacity:[{opacity:[z,w,y]}],"mix-blend":[{"mix-blend":[...Ie(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Ie()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[z]}],"mask-image-linear-from-pos":[{"mask-linear-from":D()}],"mask-image-linear-to-pos":[{"mask-linear-to":D()}],"mask-image-linear-from-color":[{"mask-linear-from":C()}],"mask-image-linear-to-color":[{"mask-linear-to":C()}],"mask-image-t-from-pos":[{"mask-t-from":D()}],"mask-image-t-to-pos":[{"mask-t-to":D()}],"mask-image-t-from-color":[{"mask-t-from":C()}],"mask-image-t-to-color":[{"mask-t-to":C()}],"mask-image-r-from-pos":[{"mask-r-from":D()}],"mask-image-r-to-pos":[{"mask-r-to":D()}],"mask-image-r-from-color":[{"mask-r-from":C()}],"mask-image-r-to-color":[{"mask-r-to":C()}],"mask-image-b-from-pos":[{"mask-b-from":D()}],"mask-image-b-to-pos":[{"mask-b-to":D()}],"mask-image-b-from-color":[{"mask-b-from":C()}],"mask-image-b-to-color":[{"mask-b-to":C()}],"mask-image-l-from-pos":[{"mask-l-from":D()}],"mask-image-l-to-pos":[{"mask-l-to":D()}],"mask-image-l-from-color":[{"mask-l-from":C()}],"mask-image-l-to-color":[{"mask-l-to":C()}],"mask-image-x-from-pos":[{"mask-x-from":D()}],"mask-image-x-to-pos":[{"mask-x-to":D()}],"mask-image-x-from-color":[{"mask-x-from":C()}],"mask-image-x-to-color":[{"mask-x-to":C()}],"mask-image-y-from-pos":[{"mask-y-from":D()}],"mask-image-y-to-pos":[{"mask-y-to":D()}],"mask-image-y-from-color":[{"mask-y-from":C()}],"mask-image-y-to-color":[{"mask-y-to":C()}],"mask-image-radial":[{"mask-radial":[w,y]}],"mask-image-radial-from-pos":[{"mask-radial-from":D()}],"mask-image-radial-to-pos":[{"mask-radial-to":D()}],"mask-image-radial-from-color":[{"mask-radial-from":C()}],"mask-image-radial-to-color":[{"mask-radial-to":C()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":p()}],"mask-image-conic-pos":[{"mask-conic":[z]}],"mask-image-conic-from-pos":[{"mask-conic-from":D()}],"mask-image-conic-to-pos":[{"mask-conic-to":D()}],"mask-image-conic-from-color":[{"mask-conic-from":C()}],"mask-image-conic-to-color":[{"mask-conic-to":C()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:oe()}],"mask-repeat":[{mask:Te()}],"mask-size":[{mask:Le()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",w,y]}],filter:[{filter:["","none",w,y]}],blur:[{blur:Ae()}],brightness:[{brightness:[z,w,y]}],contrast:[{contrast:[z,w,y]}],"drop-shadow":[{"drop-shadow":["","none",P,de,ce]}],"drop-shadow-color":[{"drop-shadow":C()}],grayscale:[{grayscale:["",z,w,y]}],"hue-rotate":[{"hue-rotate":[z,w,y]}],invert:[{invert:["",z,w,y]}],saturate:[{saturate:[z,w,y]}],sepia:[{sepia:["",z,w,y]}],"backdrop-filter":[{"backdrop-filter":["","none",w,y]}],"backdrop-blur":[{"backdrop-blur":Ae()}],"backdrop-brightness":[{"backdrop-brightness":[z,w,y]}],"backdrop-contrast":[{"backdrop-contrast":[z,w,y]}],"backdrop-grayscale":[{"backdrop-grayscale":["",z,w,y]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[z,w,y]}],"backdrop-invert":[{"backdrop-invert":["",z,w,y]}],"backdrop-opacity":[{"backdrop-opacity":[z,w,y]}],"backdrop-saturate":[{"backdrop-saturate":[z,w,y]}],"backdrop-sepia":[{"backdrop-sepia":["",z,w,y]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":i()}],"border-spacing-x":[{"border-spacing-x":i()}],"border-spacing-y":[{"border-spacing-y":i()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",w,y]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[z,"initial",w,y]}],ease:[{ease:["linear","initial",k,w,y]}],delay:[{delay:[z,w,y]}],animate:[{animate:["none",E,w,y]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[v,w,y]}],"perspective-origin":[{"perspective-origin":M()}],rotate:[{rotate:ae()}],"rotate-x":[{"rotate-x":ae()}],"rotate-y":[{"rotate-y":ae()}],"rotate-z":[{"rotate-z":ae()}],scale:[{scale:ie()}],"scale-x":[{"scale-x":ie()}],"scale-y":[{"scale-y":ie()}],"scale-z":[{"scale-z":ie()}],"scale-3d":["scale-3d"],skew:[{skew:pe()}],"skew-x":[{"skew-x":pe()}],"skew-y":[{"skew-y":pe()}],transform:[{transform:[w,y,"","none","gpu","cpu"]}],"transform-origin":[{origin:M()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:le()}],"translate-x":[{"translate-x":le()}],"translate-y":[{"translate-y":le()}],"translate-z":[{"translate-z":le()}],"translate-none":["translate-none"],accent:[{accent:C()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:C()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",w,y]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":i()}],"scroll-mx":[{"scroll-mx":i()}],"scroll-my":[{"scroll-my":i()}],"scroll-ms":[{"scroll-ms":i()}],"scroll-me":[{"scroll-me":i()}],"scroll-mt":[{"scroll-mt":i()}],"scroll-mr":[{"scroll-mr":i()}],"scroll-mb":[{"scroll-mb":i()}],"scroll-ml":[{"scroll-ml":i()}],"scroll-p":[{"scroll-p":i()}],"scroll-px":[{"scroll-px":i()}],"scroll-py":[{"scroll-py":i()}],"scroll-ps":[{"scroll-ps":i()}],"scroll-pe":[{"scroll-pe":i()}],"scroll-pt":[{"scroll-pt":i()}],"scroll-pr":[{"scroll-pr":i()}],"scroll-pb":[{"scroll-pb":i()}],"scroll-pl":[{"scroll-pl":i()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",w,y]}],fill:[{fill:["none",...C()]}],"stroke-w":[{stroke:[z,te,Z,xe]}],stroke:[{stroke:["none",...C()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Gs=vs($s);function I(...e){return Gs(it(e))}const Us=lt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),G=g.forwardRef(({className:e,variant:s,size:t,asChild:o=!1,...n},a)=>{const l=o?Ht:"button";return r.jsx(l,{className:I(Us({variant:s,size:t,className:e})),ref:a,...n})});G.displayName="Button";const Os=/^(image\/(jpeg|png|webp|gif|avif|bmp|tiff))$/i;function Vs(e){return Os.test(e.type)}function Hs(e,s=36){const t=[];for(const o of e)if(Vs(o)){if(t.length>=s)break;t.push({id:crypto.randomUUID(),url:URL.createObjectURL(o),name:o.name,size:o.size,type:o.type})}return t}function Ue(e){for(const s of e)try{URL.revokeObjectURL(s.url)}catch{}}const Ws=16,W=2050,be=1024,Xs=.8,yt="contain",Ys="left",qs="top",wt=[{id:"georgia",label:"Georgia (system)",family:"Georgia, serif"},{id:"times",label:"Times (system)",family:'"Times New Roman", Times, serif'},{id:"garamond",label:"Garamond (system)",family:"Garamond, serif"},{id:"helvetica",label:"Helvetica (system)",family:'"Helvetica Neue", Helvetica, Arial, sans-serif'},{id:"roboto",label:"Roboto (Google)",family:'"Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif',cssHref:"https://fonts.googleapis.com/css2?family=Roboto:wght@100..900&display=swap"},{id:"roboto-mono",label:"Roboto Mono (Google)",family:'"Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace',cssHref:"https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@100..700&display=swap"},{id:"courier-new",label:"Courier New (system)",family:'"Courier New", Courier, monospace'}],J={scale:1,tx:0,ty:0},ye=(e,s,t)=>Math.max(s,Math.min(t,e));function Zs(e){return new Promise((s,t)=>{const o=new Image;o.onload=()=>s({w:o.naturalWidth,h:o.naturalHeight}),o.onerror=t,o.src=e})}function Qs(e,s,t,o,n,a){const l=t/e,d=t/s,c=Math.min(l,d),m=e*c,u=s*c,x=0,h=0,P=(x-(t-m)/2)/t*100,j=(h-(t-u)/2)/t*100;return{tx:Math.max(-100,Math.min(100,P)),ty:Math.max(-100,Math.min(100,j))}}const T=Lt((e,s)=>({photos:[],max:Ws,transforms:{},layersByPhoto:{},setTransform:(t,o)=>e(n=>{const a=n.transforms[t]??J,l={scale:ye(o.scale??a.scale,.5,4),tx:ye(o.tx??a.tx,-100,100),ty:ye(o.ty??a.ty,-100,100)};return{transforms:{...n.transforms,[t]:l}}}),resetTransform:t=>e(o=>{const{[t]:n,...a}=o.transforms;return{transforms:a}}),add:t=>{if(!t?.length)return;const{photos:o,max:n}=s(),a=Math.max(0,n-o.length);if(!a)return;const l=t.slice(0,a);e({photos:[...o,...l]});for(const d of l)(async()=>{try{const{w:c,h:m}=await Zs(d.url),{tx:u,ty:x}=Qs(c,m,W,yt,Ys,qs);s().setTransform(d.id,{tx:u,ty:x})}catch{}})()},clear:()=>{const t=s().photos;t.length&&Ue(t),e({photos:[],transforms:{},layersByPhoto:{}})},remove:t=>e(o=>{const n=o.photos.findIndex(c=>c.id===t);if(n===-1)return null;Ue([o.photos[n]]);const{[t]:a,...l}=o.transforms,d={...o.layersByPhoto};return delete d[t],{photos:o.photos.filter(c=>c.id!==t),transforms:l,layersByPhoto:d}}),addTextLayer:(t,o={})=>{const n=crypto.randomUUID();return e(a=>{const l=a.layersByPhoto[t]??[],d=l.length?Math.max(...l.map(u=>u.z))+1:1,c={...o};delete c.id,delete c.type,delete c.z;const m={id:n,type:"text",x:40,y:W-140,rotation:0,scaleX:1,scaleY:1,visible:!0,z:d,text:"New text",fontFamily:"Georgia, serif",fontSize:36,fontStyle:"",fill:"#111",align:"left",verticalAlign:"top",padding:0,lineHeight:1.25,letterSpacing:0,...c};return{layersByPhoto:{...a.layersByPhoto,[t]:[...l,m]}}}),n},addRectLayer:(t,o={})=>{const n=crypto.randomUUID();return e(a=>{const l=a.layersByPhoto[t]??[],d=l.length?Math.max(...l.map(u=>u.z))+1:1,c={...o};delete c.id,delete c.type,delete c.z;const m={id:n,type:"rect",x:40,y:40,rotation:0,scaleX:1,scaleY:1,visible:!0,z:d,width:600,height:300,fill:"#ffffff",stroke:void 0,strokeWidth:0,cornerRadius:0,...c};return{layersByPhoto:{...a.layersByPhoto,[t]:[...l,m]}}}),n},updateLayer:(t,o,n)=>e(a=>{const l=a.layersByPhoto[t]??[],d=l.findIndex(h=>h.id===o);if(d===-1)return null;const c=l[d],m={...n};delete m.id,delete m.type;const u={...c,...m},x=[...l];return x[d]=u,{layersByPhoto:{...a.layersByPhoto,[t]:x}}}),removeLayer:(t,o)=>e(n=>{const a=n.layersByPhoto[t]??[],l=a.filter(d=>d.id!==o);return l===a?null:{layersByPhoto:{...n.layersByPhoto,[t]:l}}}),bringToFront:(t,o)=>e(n=>{const a=n.layersByPhoto[t]??[];if(!a.length)return null;const l=Math.max(...a.map(c=>c.z)),d=a.map(c=>c.id===o?{...c,z:l+1}:c);return{layersByPhoto:{...n.layersByPhoto,[t]:d}}}),sendToBack:(t,o)=>e(n=>{const a=n.layersByPhoto[t]??[];if(!a.length)return null;const l=Math.min(...a.map(c=>c.z)),d=a.map(c=>c.id===o?{...c,z:l-1}:c);return{layersByPhoto:{...n.layersByPhoto,[t]:d}}}),setLayersOrder:(t,o)=>e(n=>{const a=n.layersByPhoto[t]??[];if(!a.length)return null;const l=new Map(a.map(m=>[m.id,m])),d=[];let c=1;for(const m of o){const u=l.get(m);u&&d.push({...u,z:c++})}for(const m of a)o.includes(m.id)||d.push({...m,z:c++});return{layersByPhoto:{...n.layersByPhoto,[t]:d}}})}));function Js(e){const s=e.replace(/^\uFEFF/,"").replace(/\r\n?/g,`
`).split(`
`).filter(Boolean);if(!s.length)return{rows:[],hasRelative:!1};const t=s[0].toLowerCase(),o=t.includes(";")&&!t.includes(",")?";":",",n=[],a=new RegExp(`\\s*(?:"([^"]*)"|([^${o}\\n]*))\\s*(?:${o}|$)`,"g");for(const d of s){const c=[];a.lastIndex=0;let m,u=0;for(;(m=a.exec(d))&&u++<1e3;){const P=(m[1]??m[2]??"").trim();if(c.push(P),m.index+m[0].length>=d.length)break}if(!c.length)continue;const x=(c[0]??"").trim();if(!x)continue;const h=(c[1]??"").trim()||void 0;n.push({url:x,caption:h})}n.length&&n[0].url.trim().toLowerCase()==="url"&&n.shift();const l=n.some(d=>Ks(d.url));return{rows:n,hasRelative:l}}function vt(e){return/^https?:\/\//i.test(e)}function kt(e){return/^data:/i.test(e)}function Ks(e){return!(vt(e)||kt(e)||/^blob:/.test(e))}function er(){const e=g.useRef(null),s=It.useRef(null),t=T(x=>x.photos),o=T(x=>x.max),n=T(x=>x.add),a=T(x=>x.clear),l=Math.max(0,o-t.length),d=g.useCallback(x=>{if(!x?.length)return;const h=Array.from(x).slice(0,l),P=Hs(h,l);n(P)},[n,l]),c=g.useCallback(x=>{d(x.target.files),x.target.value=""},[d]);async function m(x){const h=x.target.files?.[0];if(!h)return;const P=await h.text();x.target.value="";const{rows:j,hasRelative:v}=Js(P);if(j.length){if(v){alert("В этом CSV есть относительные пути. В текущей сборке локальная папка не поддерживается. Пожалуйста, используйте полные URL (http/https) или добавьте изображения кнопкой “Choose images”.");return}await u(j)}}async function u(x,h){const P=T.getState().add,j=[];let v=0,S=0;for(const k of x)try{let E=null,b="image";if(vt(k.url)){const N=await fetch(k.url,{mode:"cors"});if(!N.ok)throw new Error(`HTTP ${N.status}`);E=await N.blob(),b=k.url.split("/").pop()||b}else if(kt(k.url))E=await(await fetch(k.url)).blob(),b="data.png";else throw new Error("Relative paths are disabled in this build");const p=URL.createObjectURL(E),M=crypto.randomUUID();j.push({id:M,url:p,name:b}),v++}catch(E){console.warn("CSV import skip:",k.url,E),S++}P(j),S&&alert(`CSV import: added ${v}, skipped ${S}`)}return r.jsx("section",{className:"mt-4 space-y-4",children:r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsxs("div",{className:"text-sm opacity-80",children:["Cards: ",r.jsx("b",{children:t.length})," / ",o]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{ref:e,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:c}),r.jsx("input",{ref:s,type:"file",accept:".csv,text/csv",className:"hidden",onChange:m}),r.jsx("button",{onClick:()=>s.current?.click(),className:"rounded-md bg-background/80 px-3 py-2 text-sm shadow hover:bg-background",children:"Import CSV"}),r.jsx("button",{onClick:()=>e.current?.click(),className:"rounded-md bg-background/80 px-3 py-2 text-sm shadow hover:bg-background",children:"Choose images"}),r.jsx(G,{variant:"destructive",onClick:a,disabled:!t.length,children:"Clear"})]})]})})}const tr="modulepreload",sr=function(e){return"/ss/"+e},Oe={},rr=function(s,t,o){let n=Promise.resolve();if(t&&t.length>0){let c=function(m){return Promise.all(m.map(u=>Promise.resolve(u).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),d=l?.nonce||l?.getAttribute("nonce");n=c(t.map(m=>{if(m=sr(m),m in Oe)return;Oe[m]=!0;const u=m.endsWith(".css"),x=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${x}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":tr,u||(h.as="script"),h.crossOrigin="",h.href=m,d&&h.setAttribute("nonce",d),document.head.appendChild(h),u)return new Promise((P,j)=>{h.addEventListener("load",P),h.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${m}`)))})}))}function a(l){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=l,window.dispatchEvent(d),!d.defaultPrevented)throw l}return n.then(l=>{for(const d of l||[])d.status==="rejected"&&a(d.reason);return s().catch(a)})},jt=g.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:I("rounded-xl border bg-card text-card-foreground shadow",e),...s}));jt.displayName="Card";const or=g.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:I("flex flex-col space-y-1.5 p-6",e),...s}));or.displayName="CardHeader";const nr=g.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:I("font-semibold leading-none tracking-tight",e),...s}));nr.displayName="CardTitle";const ar=g.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:I("text-sm text-muted-foreground",e),...s}));ar.displayName="CardDescription";const ir=g.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:I("p-6 pt-0",e),...s}));ir.displayName="CardContent";const lr=g.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:I("flex items-center p-6 pt-0",e),...s}));lr.displayName="CardFooter";const Nt=g.forwardRef(({className:e,value:s,...t},o)=>r.jsx(We,{ref:o,className:I("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...t,children:r.jsx(Wt,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));Nt.displayName=We.displayName;const Ct=Jt,Rt=Kt,Ce=g.forwardRef(({className:e,children:s,...t},o)=>r.jsxs(Xe,{ref:o,className:I("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...t,children:[s,r.jsx(Xt,{asChild:!0,children:r.jsx(He,{className:"h-4 w-4 opacity-50"})})]}));Ce.displayName=Xe.displayName;const St=g.forwardRef(({className:e,...s},t)=>r.jsx(Ye,{ref:t,className:I("flex cursor-default items-center justify-center py-1",e),...s,children:r.jsx(At,{className:"h-4 w-4"})}));St.displayName=Ye.displayName;const Pt=g.forwardRef(({className:e,...s},t)=>r.jsx(qe,{ref:t,className:I("flex cursor-default items-center justify-center py-1",e),...s,children:r.jsx(He,{className:"h-4 w-4"})}));Pt.displayName=qe.displayName;const Re=g.forwardRef(({className:e,children:s,position:t="popper",...o},n)=>r.jsx(Yt,{children:r.jsxs(Ze,{ref:n,className:I("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t,...o,children:[r.jsx(St,{}),r.jsx(qt,{className:I("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),r.jsx(Pt,{})]})}));Re.displayName=Ze.displayName;const cr=g.forwardRef(({className:e,...s},t)=>r.jsx(Qe,{ref:t,className:I("px-2 py-1.5 text-sm font-semibold",e),...s}));cr.displayName=Qe.displayName;const re=g.forwardRef(({className:e,children:s,...t},o)=>r.jsxs(Je,{ref:o,className:I("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[r.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(Zt,{children:r.jsx(Ft,{className:"h-4 w-4"})})}),r.jsx(Qt,{children:s})]}));re.displayName=Je.displayName;const dr=g.forwardRef(({className:e,...s},t)=>r.jsx(Ke,{ref:t,className:I("-mx-1 my-1 h-px bg-muted",e),...s}));dr.displayName=Ke.displayName;function ur(e,s,t){if(!s?.length)return;const o=t/W,n=[...s].sort((a,l)=>a.z-l.z);for(const a of n)a.visible!==!1&&a.type==="text"&&fr(e,a,o)}function mr(e,s,t,o=0){const n=[];if(!s)return n;const a=s.replace(/\r\n?/g,`
`).split(`
`),l=d=>e.measureText(d).width+Math.max(0,d.length-1)*o;for(const d of a){if(!t||t<=0){n.push(d);continue}const c=d.split(/\s+/);let m="";for(const u of c){const x=m?m+" "+u:u;if(l(x)<=t)m=x;else if(m&&n.push(m),l(u)>t){let h="";for(const P of u){const j=h+P;l(j)<=t?h=j:(h&&n.push(h),h=P)}m=h}else m=u}n.push(m)}return n}function fr(e,s,t){e.save(),e.translate(s.x*t,s.y*t),s.rotation&&e.rotate(s.rotation*Math.PI/180);const o=s.fontFamily||"system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif",n=Math.max(1,s.fontSize||16)*t,a=s.fontStyle||"",l=[];a.includes("italic")&&l.push("italic"),a.includes("bold")&&l.push("bold"),l.push(`${n}px`,o),e.font=l.join(" "),e.fontKerning="none",e.fillStyle=s.fill||"#111",e.textBaseline="top",e.textAlign="left";const d=Math.max(0,s.padding??0)*t,c=(s.width??0)>0?Math.max(0,s.width*t-d*2):void 0,m=s.align||"left",u=n*(s.lineHeight??1.25),x=(s.letterSpacing??0)*t,h=mr(e,s.text??"",c,x);let P=d;for(const j of h){let v=0;for(let E=0;E<j.length;E++){const b=j[E];v+=e.measureText(b).width,E<j.length-1&&(v+=x)}let S=d;c!==void 0&&(m==="center"?S=d+(c-v)/2:m==="right"&&(S=d+(c-v)));let k=S;for(let E=0;E<j.length;E++){const b=j[E];e.fillText(b,k,P),k+=e.measureText(b).width,E<j.length-1&&(k+=x)}P+=u}e.restore()}const we=new Map;function me(e){const s=e.trim();if(s.startsWith('"')){const t=s.indexOf('"',1);return t>1?s.slice(1,t):s.replace(/["']/g,"")}return s.split(",")[0].replace(/["']/g,"").trim()}function pr(e){const s=me(e);return wt.find(t=>me(t.family).toLowerCase()===s.toLowerCase())}function hr(e,s){if(document.getElementById(s))return;const t=document.createElement("link");t.id=s,t.rel="stylesheet",t.href=e;const o=document.createElement("link");o.rel="preconnect",o.href="https://fonts.googleapis.com";const n=document.createElement("link");n.rel="preconnect",n.href="https://fonts.gstatic.com",n.crossOrigin="anonymous",document.head.appendChild(o),document.head.appendChild(n),document.head.appendChild(t)}function zt(e){const s=me(e);if(we.has(s))return we.get(s);const t=(async()=>{const o=pr(e);o&&o.cssHref&&hr(o.cssHref,`font-css-${o.id}`);try{const n=document;n?.fonts?.ready&&typeof n.fonts.ready.then=="function"&&await n.fonts.ready}catch{}try{document.fonts?.load&&await document.fonts.load(`1em ${me(e)}`)}catch{}})();return we.set(s,t),t}async function gr(e){if(!e?.length)return;const s=new Set;for(const t of e)t.type==="text"&&t.fontFamily&&s.add(t.fontFamily);await Promise.all(Array.from(s).map(t=>zt(t)))}async function xr(){const e=document;if(e?.fonts?.ready&&typeof e.fonts.ready.then=="function")try{await e.fonts.ready}catch{}}async function br(e){return new Promise((s,t)=>{const o=new Image;o.onload=()=>s(o),o.onerror=n=>t(n),o.src=e})}function yr(e,s="card"){return(e.replace(/\.[^.]+$/,"").replace(/[^a-z0-9_\-]+/gi,"_").replace(/^_+|_+$/g,"")||s).slice(0,100)}function wr(e,s){const t=document.createElement("a"),o=URL.createObjectURL(e);t.href=o,t.download=s,document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(o)}async function vr(e,s,t={}){const o=t.size??W,n=t.bg??"transparent",a=t.transform??J;await gr(t.layers),await xr();const l=document.createElement("canvas");l.width=o,l.height=o;const d=l.getContext("2d");if(!d)throw new Error("No 2D context");n!=="transparent"&&(d.fillStyle=n,d.fillRect(0,0,o,o));const c=await br(e.url),m=o/c.width,u=o/c.height,h=Math.min(m,u)*a.scale,P=Math.round(c.width*h),j=Math.round(c.height*h),v=Math.round((o-P)/2+a.tx/100*o),S=Math.round((o-j)/2+a.ty/100*o);d.imageSmoothingQuality="high",d.drawImage(c,v,S,P,j),ur(d,t.layers,o);const k=await new Promise((E,b)=>l.toBlob(p=>p?E(p):b(new Error("toBlob failed")),"image/png"));wr(k,`${yr(e.name||"card")}.png`)}const Mt=ss,kr=es,Et=g.forwardRef(({className:e,...s},t)=>r.jsx(et,{ref:t,className:I("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));Et.displayName=et.displayName;const Se=g.forwardRef(({className:e,children:s,...t},o)=>r.jsxs(kr,{children:[r.jsx(Et,{}),r.jsxs(tt,{ref:o,className:I("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[s,r.jsxs(ts,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[r.jsx(Bt,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Se.displayName=tt.displayName;const Pe=({className:e,...s})=>r.jsx("div",{className:I("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});Pe.displayName="DialogHeader";const ze=({className:e,...s})=>r.jsx("div",{className:I("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});ze.displayName="DialogFooter";const Me=g.forwardRef(({className:e,...s},t)=>r.jsx(st,{ref:t,className:I("text-lg font-semibold leading-none tracking-tight",e),...s}));Me.displayName=st.displayName;const Tt=g.forwardRef(({className:e,...s},t)=>r.jsx(rt,{ref:t,className:I("text-sm text-muted-foreground",e),...s}));Tt.displayName=rt.displayName;const jr=lt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),se=g.forwardRef(({className:e,...s},t)=>r.jsx(ot,{ref:t,className:I(jr(),e),...s}));se.displayName=ot.displayName;const ue=g.forwardRef(({className:e,...s},t)=>r.jsxs(nt,{ref:t,className:I("relative flex w-full touch-none select-none items-center",e),...s,children:[r.jsx(rs,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:r.jsx(os,{className:"absolute h-full bg-primary"})}),r.jsx(ns,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));ue.displayName=nt.displayName;const Nr=[];function Cr(e,s=""){const[t,o]=g.useState(null),[n,a]=g.useState("idle");return g.useEffect(()=>{if(!e){o(null),a("idle");return}let l=!1;const d=new Image;return s&&(d.crossOrigin=s),a("loading"),d.onload=()=>{l||(o(d),a("loaded"))},d.onerror=()=>{l||(o(null),a("failed"))},d.src=e,()=>{l=!0}},[e,s]),[t,n]}const Ee=g.forwardRef(function({photoId:s,size:t,selectedId:o,onSelect:n},a){const d=g.useRef(null),c=T(b=>b.photos.find(p=>p.id===s)?.url),m=T(b=>b.transforms[s]??J),[u,x]=Cr(c??"","anonymous"),h=x==="loaded";g.useImperativeHandle(a,()=>({toDataURL:b=>{const p=d.current;if(!p)return null;const M=b&&b>0?b/t:1;return p.toDataURL({pixelRatio:M,mimeType:"image/png"})},isReady:()=>!!d.current&&h}));const P=T(b=>b.layersByPhoto[s]??Nr,Object.is),j=T(b=>b.updateLayer),v=g.useRef(null),S=g.useRef(null);g.useEffect(()=>{const b=v.current,p=S.current;b&&p&&o&&(b.nodes([p]),b.getLayer()?.batchDraw())},[o]);const k=t/W;function E(b,p,M,N){const A=p/b.width,i=p/b.height,L=Math.min(A,i)*(N?.scale??1),F=b.width*L,U=b.height*L,$=(p-F)/2+(N?.tx??0)/100*p,R=(p-U)/2+(N?.ty??0)/100*p;return{x:$*k,y:R*k,width:F*k,height:U*k}}return r.jsx(Dt,{ref:d,width:t,height:t,pixelRatio:1,listening:!0,style:{width:"100%",height:"100%"},onMouseDown:b=>{b.target===b.target.getStage()&&n(null)},onTouchStart:b=>{b.target===b.target.getStage()&&n(null)},children:r.jsxs(_t,{children:[u?r.jsx($t,{image:u,...E(u,W,yt,m),listening:!1}):null,P.slice().sort((b,p)=>b.z-p.z).map(b=>(()=>{if(b.type==="text"){const p=b,N=o===p.id?S:void 0,A=p.x*k,i=p.y*k,f=(p.fontSize??16)*k,L=p.width?p.width*k:void 0,F=(p.padding??0)*k,U=(p.letterSpacing??0)*k;return r.jsx(Gt,{ref:N,draggable:!0,x:A,y:i,text:p.text,fontFamily:p.fontFamily||"Georgia, serif",fontSize:f,fontStyle:p.fontStyle,fill:p.fill,width:L,align:p.align,lineHeight:p.lineHeight??1.25,padding:F,letterSpacing:U,rotation:p.rotation,scaleX:1,scaleY:1,visible:p.visible,perfectDrawEnabled:!1,onTransform:$=>{const R=$.target,V=typeof R.scaleX=="function"?R.scaleX():1,_=typeof R.width=="function"?R.width():void 0;_!==void 0&&V&&V!==1&&(R.width(Math.max(4,Math.round(_*V))),typeof R.scaleX=="function"&&R.scaleX(1),typeof R.scaleY=="function"&&R.scaleY(1),R.getLayer()?.batchDraw())},onMouseDown:()=>n(p.id),onTap:()=>n(p.id),onDragEnd:$=>{j(s,p.id,{x:$.target.x()/k,y:$.target.y()/k})},onTransformEnd:$=>{const R=$.target,V=typeof R.scaleX=="function"?R.scaleX():1,_=typeof R.width=="function"?R.width():void 0,X={x:R.x()/k,y:R.y()/k,rotation:R.rotation(),scaleX:1,scaleY:1,width:_!==void 0?Math.max(4,Math.round(_*V/k)):void 0};typeof R.scaleX=="function"&&R.scaleX(1),typeof R.scaleY=="function"&&R.scaleY(1),j(s,p.id,X)}},p.id)}if(b.type==="rect"){const p=b,N=o===p.id?S:void 0,A=p.x*k,i=p.y*k,f=Math.max(1,(p.width??100)*k),L=Math.max(1,(p.height??100)*k),F=Math.max(0,(p.strokeWidth??0)*k),U=Math.max(0,(p.cornerRadius??0)*k);return r.jsx(Ut,{ref:N,draggable:!0,x:A,y:i,width:f,height:L,rotation:p.rotation,fill:p.fill??"#ffffff",stroke:p.stroke,strokeWidth:F,cornerRadius:U,visible:p.visible,onMouseDown:()=>n(p.id),onTap:()=>n(p.id),onDragEnd:$=>{j(s,p.id,{x:$.target.x()/k,y:$.target.y()/k})},onTransformEnd:$=>{const R=$.target,V=typeof R.scaleX=="function"?R.scaleX():1,_=typeof R.scaleY=="function"?R.scaleY():1,X=typeof R.width=="function"?R.width():f,C=typeof R.height=="function"?R.height():L,oe={x:R.x()/k,y:R.y()/k,rotation:R.rotation(),scaleX:1,scaleY:1,width:Math.max(1,Math.round(X*V/k)),height:Math.max(1,Math.round(C*_/k))};typeof R.scaleX=="function"&&R.scaleX(1),typeof R.scaleY=="function"&&R.scaleY(1),j(s,p.id,oe)}},p.id)}return null})()),o&&r.jsx(Ot,{ref:v,rotateEnabled:!0,enabledAnchors:["middle-left","middle-right","top-center","bottom-center","top-left","top-right","bottom-left","bottom-right"],borderStroke:"#fff",anchorStroke:"#fff",anchorFill:"#111",anchorSize:7,keepRatio:!1,centeredScaling:!1,boundBoxFunc:(b,p)=>{const N=Math.max(6,p.width),A=Math.max(6,p.height);return{...p,width:N,height:A}}})]})})}),Rr=[];function Sr({open:e,onOpenChange:s,photo:t,canvasRef:o}){const n=T(i=>i.addTextLayer),a=T(i=>i.addRectLayer),l=T(i=>i.transforms[t.id]??J),d=T(i=>i.setTransform),[c,m]=g.useState(l),[u,x]=g.useState(null),h=T(i=>i.updateLayer),P=T(i=>i.removeLayer),j=T(i=>i.bringToFront),v=T(i=>i.sendToBack),S=T(i=>i.layersByPhoto[t.id]??Rr,Object.is),k=g.useRef(null),E=o??k;g.useEffect(()=>{e&&m(l)},[e,l]);const b=g.useRef(null),[p,M]=g.useState(0),N=g.useCallback(()=>{const i=b.current;if(!i)return;const f=Math.round(i.clientWidth);f&&M(f)},[]);g.useEffect(()=>{const i=b.current;if(!i)return;const f=new ResizeObserver(N);return f.observe(i),N(),()=>f.disconnect()},[N]),g.useEffect(()=>{e&&(requestAnimationFrame(N),setTimeout(N,50))},[e,N]);const A=g.useCallback((i,f)=>{const L=i.id.slice(0,6);return`${i.type==="text"?"Text":i.type==="rect"?"Rect":"Layer"} #${f+1} (${L})`},[]);return g.useEffect(()=>{if(!u)return;(S??[]).some(f=>f.id===u)||x(null)},[S,u]),r.jsx(Mt,{open:e,onOpenChange:s,children:r.jsxs(Se,{"aria-describedby":void 0,className:"max-w-[min(96vw,52rem)] max-h-[96vh] p-2 overflow-hidden flex flex-col",onOpenAutoFocus:()=>{requestAnimationFrame(()=>setTimeout(N,50))},children:[r.jsxs(Pe,{className:"shrink-0",children:[r.jsx(Me,{children:"Edit card"}),r.jsx(Tt,{className:"sr-only",children:"Adjust zoom/position and edit text layers."})]}),r.jsx("div",{className:"flex-1 overflow-auto",children:r.jsxs("div",{className:"grid gap-4",children:[r.jsx("div",{className:"mx-auto w-full max-w-[min(86vw,70vh)] rounded-xl border border-border bg-muted/20",children:r.jsx("div",{className:"relative aspect-square overflow-hidden rounded-xl",ref:b,children:p>0&&r.jsx("div",{className:"absolute inset-0 pointer-events-auto z-0",children:r.jsx(Ee,{ref:E,photoId:t.id,size:p,selectedId:u,onSelect:x})})})}),r.jsx("div",{className:"mx-auto w-full max-w-[min(86vw,70vh)]",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(se,{className:"whitespace-nowrap",children:"Layers"}),r.jsxs(Ct,{value:u??void 0,onValueChange:i=>x(i||null),children:[r.jsx(Ce,{className:"w-[18rem]",children:r.jsx(Rt,{placeholder:S.length?"Select a layer…":"No layers"})}),r.jsx(Re,{children:S.length===0?r.jsx(re,{value:"__no_layers__",disabled:!0,children:"No layers"}):S.slice().sort((i,f)=>i.z-f.z).map((i,f)=>r.jsx(re,{value:i.id,children:A(i,f)},i.id))})]}),r.jsx("div",{className:"ml-auto"})]})}),u&&(()=>{const i=S.find(f=>f.id===u&&f.type==="text");return i?r.jsxs("div",{className:"mt-2 grid gap-2 rounded-md border p-2 bg-background/60",children:[r.jsx("label",{className:"text-xs opacity-70",children:"Text"}),r.jsx("textarea",{value:i.text,onChange:f=>h(t.id,i.id,{text:f.target.value}),rows:3,className:"resize-y w-full rounded border px-2 py-1 text-sm bg-background"}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("label",{className:"text-xs opacity-70",children:"Size"}),r.jsx("input",{type:"number",min:8,max:240,step:1,value:i.fontSize??36,onChange:f=>h(t.id,i.id,{fontSize:Number(f.target.value)}),className:"w-20 rounded border px-2 py-1 text-sm"}),r.jsx("button",{type:"button",className:`rounded border px-2 py-1 text-sm ${i.fontStyle?.includes("bold")?"bg-foreground/10":""}`,onClick:()=>{const f=i.fontStyle?.includes("bold"),F=`${i.fontStyle?.includes("italic")?"italic":""} ${f?"":"bold"}`.trim();h(t.id,i.id,{fontStyle:F})},children:"Bold"}),r.jsx("button",{type:"button",className:`rounded border px-2 py-1 text-sm ${i.fontStyle?.includes("italic")?"bg-foreground/10":""}`,onClick:()=>{const f=i.fontStyle?.includes("bold"),F=`${i.fontStyle?.includes("italic")?"":"italic"} ${f?"bold":""}`.trim();h(t.id,i.id,{fontStyle:F})},children:"Italic"}),r.jsx("label",{className:"text-xs opacity-70 ml-2",children:"Color"}),r.jsx("input",{type:"color",value:i.fill??"#111111",onChange:f=>h(t.id,i.id,{fill:f.target.value}),className:"h-8 w-10 cursor-pointer"})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("label",{className:"text-xs opacity-70",children:"Font"}),r.jsx("select",{value:i.fontFamily??"Georgia, serif",onChange:async f=>{const L=f.target.value;await zt(L),h(t.id,i.id,{fontFamily:L})},className:"rounded border px-2 py-1 text-sm",children:wt.map(f=>r.jsx("option",{value:f.family,children:f.label},f.id))})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("label",{className:"text-xs opacity-70",children:"Align"}),["left","center","right"].map(f=>r.jsx("button",{type:"button",className:`rounded border px-2 py-1 text-sm ${i.align===f?"bg-foreground/10":""}`,onClick:()=>h(t.id,i.id,{align:f}),children:f},f)),r.jsx("label",{className:"text-xs opacity-70 ml-2",children:"Wrap width"}),r.jsx("input",{type:"number",min:0,max:W,step:10,value:i.width??0,onChange:f=>h(t.id,i.id,{width:Number(f.target.value)||void 0}),className:"w-24 rounded border px-2 py-1 text-sm",title:"0 disables wrapping"}),r.jsx("label",{className:"text-xs opacity-70 ml-2",children:"Padding"}),r.jsx("input",{type:"number",min:0,max:200,step:1,value:i.padding??0,onChange:f=>h(t.id,i.id,{padding:Number(f.target.value)}),className:"w-20 rounded border px-2 py-1 text-sm"}),r.jsx("label",{className:"text-xs opacity-70 ml-2",children:"Line height"}),r.jsx("input",{type:"number",min:.8,max:2,step:.05,value:i.lineHeight??1.25,onChange:f=>h(t.id,i.id,{lineHeight:Number(f.target.value)}),className:"w-24 rounded border px-2 py-1 text-sm"}),r.jsx("label",{className:"text-xs opacity-70 ml-2",children:"Tracking"}),r.jsx("input",{type:"number",min:-5,max:20,step:.5,value:i.letterSpacing??0,onChange:f=>h(t.id,i.id,{letterSpacing:Number(f.target.value)}),className:"w-24 rounded border px-2 py-1 text-sm",title:"Additional spacing between glyphs (px, card space)"})]})]}):null})(),u&&(()=>{const i=S.find(f=>f.id===u&&f.type==="rect");return i?r.jsx("div",{className:"mt-2 grid gap-2 rounded-md border p-2 bg-background/60",children:r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsx("label",{className:"text-xs opacity-70",children:"Fill"}),r.jsx("input",{type:"color",value:i.fill??"#ffffff",onChange:f=>h(t.id,i.id,{fill:f.target.value}),className:"h-8 w-10 cursor-pointer"}),r.jsx("label",{className:"text-xs opacity-70",children:"Stroke"}),r.jsx("input",{type:"color",value:i.stroke??"#000000",onChange:f=>h(t.id,i.id,{stroke:f.target.value}),className:"h-8 w-10 cursor-pointer"}),r.jsx("label",{className:"text-xs opacity-70",children:"Stroke width"}),r.jsx("input",{type:"number",min:0,max:100,step:1,value:i.strokeWidth??0,onChange:f=>h(t.id,i.id,{strokeWidth:Number(f.target.value)}),className:"w-24 rounded border px-2 py-1 text-sm",title:"Width in card pixels"}),r.jsx("label",{className:"text-xs opacity-70",children:"Radius"}),r.jsx("input",{type:"number",min:0,max:500,step:1,value:i.cornerRadius??0,onChange:f=>h(t.id,i.id,{cornerRadius:Number(f.target.value)}),className:"w-24 rounded border px-2 py-1 text-sm",title:"Corner radius in card pixels"}),r.jsx("label",{className:"text-xs opacity-70",children:"Width"}),r.jsx("input",{type:"number",min:1,max:W,step:1,value:i.width??1,onChange:f=>h(t.id,i.id,{width:Number(f.target.value)}),className:"w-24 rounded border px-2 py-1 text-sm"}),r.jsx("label",{className:"text-xs opacity-70",children:"Height"}),r.jsx("input",{type:"number",min:1,max:W,step:1,value:i.height??1,onChange:f=>h(t.id,i.id,{height:Number(f.target.value)}),className:"w-24 rounded border px-2 py-1 text-sm"})]})}):null})(),r.jsx("div",{className:"mx-auto w-full max-w-[min(86vw,70vh)]",children:r.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:[r.jsx(G,{variant:"secondary",disabled:!u,onClick:()=>{if(!u)return;const f=(T.getState().layersByPhoto[t.id]??[]).find(U=>U.id===u);if(!f)return;const F=((f.rotation??0)-90)%360;h(t.id,u,{rotation:F<0?F+360:F})},children:"Rotate −90°"}),r.jsx(G,{variant:"secondary",disabled:!u,onClick:()=>{if(!u)return;const f=(T.getState().layersByPhoto[t.id]??[]).find(U=>U.id===u);if(!f)return;const F=((f.rotation??0)+90)%360;h(t.id,u,{rotation:F})},children:"Rotate +90°"}),r.jsx(G,{variant:"secondary",disabled:!u,onClick:()=>u&&j(t.id,u),children:"Bring to front"}),r.jsx(G,{variant:"secondary",disabled:!u,onClick:()=>u&&v(t.id,u),children:"Send to back"}),r.jsx(G,{variant:"destructive",disabled:!u,onClick:()=>{u&&(P(t.id,u),x(null))},children:"Delete layer"})]})}),r.jsx("div",{className:"mx-auto w-full max-w-[min(86vw,70vh)]",children:r.jsxs("div",{className:"grid gap-3",children:[r.jsxs("div",{className:"grid gap-1.5",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx(se,{children:"Zoom"}),r.jsxs("span",{className:"tabular-nums opacity-70",children:[c.scale.toFixed(2),"×"]})]}),r.jsx(ue,{value:[c.scale],min:1,max:3,step:.01,onValueChange:([i])=>m(f=>({...f,scale:i}))})]}),r.jsxs("div",{className:"grid gap-1.5",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx(se,{children:"Horizontal"}),r.jsxs("span",{className:"tabular-nums opacity-70",children:[c.tx.toFixed(0),"%"]})]}),r.jsx(ue,{value:[c.tx],min:-100,max:100,step:.1,onValueChange:([i])=>m(f=>({...f,tx:i}))})]}),r.jsxs("div",{className:"grid gap-1.5",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx(se,{children:"Vertical"}),r.jsxs("span",{className:"tabular-nums opacity-70",children:[c.ty.toFixed(0),"%"]})]}),r.jsx(ue,{value:[c.ty],min:-100,max:100,step:.1,onValueChange:([i])=>m(f=>({...f,ty:i}))})]})]})})]})}),r.jsxs(ze,{className:"shrink-0 space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsx(G,{variant:"ghost",onClick:()=>m(J),children:"Reset image"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(G,{variant:"secondary",onClick:()=>s(!1),children:"Cancel"}),r.jsx(G,{onClick:()=>{d(t.id,c),s(!1)},children:"Save"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(G,{variant:"secondary",onClick:()=>{const i=n(t.id,{text:"New text",fontSize:48,fontFamily:"Georgia, serif",fill:"#fff",x:40,y:40,align:"left"});x(i)},children:"Add text layer"}),r.jsx(G,{variant:"secondary",onClick:()=>{const i=a(t.id,{x:40,y:40,width:600,height:300,fill:"#ffffff",stroke:"#111111",strokeWidth:0,cornerRadius:0});x(i)},children:"Add rectangle"})]})]})]})})}function Pr(e,s="card"){return(e.replace(/\.[^.]+$/,"").replace(/[^a-z0-9_\-]+/gi,"_").replace(/^_+|_+$/g,"")||s).slice(0,100)}function zr(e,s){const t=document.createElement("a");t.href=e,t.download=s,document.body.appendChild(t),t.click(),t.remove()}function Mr({open:e,onOpenChange:s,photo:t,transform:o,layers:n,snapshot:a,onEdit:l}){const[d,c]=g.useState(null),[m,u]=g.useState(!1),x=g.useRef(null),[h,P]=g.useState(0);g.useEffect(()=>{const b=x.current;if(!b)return;const p=()=>P(Math.round(b.clientWidth));p();const M=new ResizeObserver(p);return M.observe(b),()=>M.disconnect()},[]);const j=g.useRef(null),[v,S]=g.useState(be),k=g.useMemo(()=>e?r.jsx("div",{"aria-hidden":!0,style:{position:"fixed",left:-1e4,top:-1e4,width:v,height:v,overflow:"hidden"},children:r.jsx(Ee,{ref:j,photoId:t.id,size:v,selectedId:null,onSelect:()=>{}})}):null,[e,t.id,v]);async function E(b){S(b),await new Promise(M=>setTimeout(M,0));try{const M=document;M?.fonts?.ready&&typeof M.fonts.ready.then=="function"&&await M.fonts.ready}catch{}const p=Date.now()+1e3;for(;!j.current?.isReady?.()&&!(Date.now()>p);)await new Promise(M=>setTimeout(M,30));return j.current?.toDataURL(b)??null}return g.useEffect(()=>{let b=!1;if(!e){c(null);return}return(async()=>{u(!0);const p=Math.max(be,h||be);let M=null;a&&(M=a(p)),M||(M=await E(p)),!b&&(c(M),u(!1))})(),()=>{b=!0}},[e,h,t.id,o.scale,o.tx,o.ty,n,a]),r.jsxs(Mt,{open:e,onOpenChange:s,children:[k,r.jsxs(Se,{"aria-describedby":void 0,className:"max-w-[min(96vw,52rem)] max-h-[96vh] p-2 overflow-hidden",children:[r.jsx(Pe,{children:r.jsx(as,{asChild:!0,children:r.jsx(Me,{children:"Preview"})})}),r.jsx("div",{className:"mx-auto w-full max-w-[min(86vw,70vh)] rounded-xl border border-border bg-muted/20",children:r.jsxs("div",{ref:x,className:"relative aspect-square overflow-hidden rounded-xl",children:[d?r.jsx("img",{src:d,alt:t.name,className:"absolute inset-0 w-full h-full object-contain"}):r.jsx("div",{className:"h-24"}),r.jsx("div",{className:`pointer-events-none absolute inset-0 grid place-items-center transition-opacity ${m?"opacity-100":"opacity-0"} bg-background/80 backdrop-blur-[2px]`,"aria-hidden":!m,children:r.jsx("div",{className:"h-7 w-7 animate-spin rounded-full border-2 border-foreground/40 border-t-transparent"})})]})}),r.jsxs(ze,{className:"mt-2 gap-2",children:[r.jsx(G,{variant:"secondary",onClick:()=>{s(!1),l?.()},children:"Edit"}),r.jsx(G,{variant:"secondary",onClick:()=>s(!1),children:"Close"}),r.jsx(G,{onClick:async()=>{const b=a&&a(W)||await E(W);b&&zr(b,`${Pr(t.name||"card")}.png`)},children:"Save PNG"})]})]})]})}function Er({photo:e}){const s=T(N=>N.remove),t=T(N=>N.transforms[e.id]??J),o=T(N=>N.layersByPhoto),[n,a]=g.useState(!1),[l,d]=g.useState(!1),c=g.useRef(null),m=g.useRef(null),[u,x]=g.useState(0);g.useEffect(()=>{const N=m.current;if(!N)return;const A=()=>x(N.clientWidth);A();const i=new ResizeObserver(A);return i.observe(N),()=>i.disconnect()},[]);const h=g.useRef(null),[P,j]=g.useState(512),v=r.jsx("div",{"aria-hidden":!0,style:{position:"fixed",left:-1e4,top:-1e4,width:P,height:P,overflow:"hidden"},children:r.jsx(Ee,{ref:h,photoId:e.id,size:P,selectedId:null,onSelect:()=>{}})}),[S,k]=g.useState(null),[E,b]=g.useState(!0),p=g.useRef(null);g.useEffect(()=>{if(n)return;const N=window.devicePixelRatio||1,A=Math.max(384,Math.min(1024,Math.round((u||300)*N)));return j(A),p.current&&window.clearTimeout(p.current),p.current=window.setTimeout(async()=>{b(!0);try{const L=document;L?.fonts?.ready&&typeof L.fonts.ready.then=="function"&&await L.fonts.ready}catch{}const i=Date.now()+800;for(;!h.current?.isReady?.()&&!(Date.now()>i);)await new Promise(L=>setTimeout(L,25));const f=h.current?.toDataURL(A)??null;k(f),b(!1)},150),()=>{p.current&&(window.clearTimeout(p.current),p.current=null)}},[u,n,e.id,t.scale,t.tx,t.ty,o[e.id]]);const M=g.useCallback(async()=>{await vr(e,"",{size:W,transform:t,layers:o[e.id]})},[e,t,o]);return r.jsxs(r.Fragment,{children:[v,r.jsxs("div",{className:"overflow-hidden rounded-xl border border-foreground/15 bg-foreground/[0.02]",children:[r.jsxs("div",{ref:m,onClick:()=>d(!0),className:"relative aspect-square w-full overflow-hidden cursor-zoom-in",children:[r.jsx("button",{"aria-label":"Remove image",title:"Remove",onClick:N=>{N.stopPropagation(),s(e.id)},className:"absolute right-1 top-1 z-10 rounded-md bg-background/80 px-1.5 py-0.5 text-[11px] shadow hover:bg-background",children:"×"}),S?r.jsx("img",{src:S,alt:e.name,className:"h-full w-full object-cover"}):r.jsx("div",{className:"h-full w-full bg-foreground/[0.06]"}),r.jsx("div",{className:`pointer-events-none absolute inset-0 grid place-items-center transition-opacity ${E?"opacity-100":"opacity-0"} bg-background/80 backdrop-blur-[2px]`,"aria-hidden":!E,children:r.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-2 border-foreground/40 border-t-transparent"})})]}),r.jsxs("div",{className:"flex items-center justify-between gap-2 border-t bg-background/70 px-2 py-1.5 supports-[backdrop-filter]:bg-background/60",children:[r.jsx("button",{"aria-label":"Edit card",title:"Edit",onClick:N=>{N.stopPropagation(),a(!0)},className:"rounded-md bg-background/80 px-2 py-1 text-[12px] shadow hover:bg-background",children:"Edit"}),r.jsx("button",{"aria-label":"Save PNG",title:"Save PNG",onClick:N=>{N.stopPropagation(),M()},className:"rounded-md bg-background/80 px-2 py-1 text-[12px] shadow hover:bg-background",children:"Save PNG"})]})]}),r.jsx(Mr,{open:l,onOpenChange:d,photo:e,transform:t,layers:o[e.id],snapshot:N=>c.current?.toDataURL(N)??null,onEdit:()=>a(!0)}),r.jsx(Sr,{open:n,onOpenChange:a,photo:e,canvasRef:c})]})}function Ve(e){const s=e/1e3;return s<60?`${s.toFixed(1)}s`:`${Math.floor(s/60)}m ${(s%60).toFixed(0)}s`}function Tr(){const e=T(v=>v.photos),s=T(v=>v.transforms),t=T(v=>v.layersByPhoto),[o,n]=g.useState(!1),[a,l]=g.useState(null),d=g.useRef(!1),[c,m]=g.useState("jpeg"),[u,x]=g.useState(Xs*100),h=a?.pct??0,P=g.useMemo(()=>{if(!a)return"";const v=a.etaMs??0;return`Rendering ${a.done}/${a.total} • ${h}% • elapsed ${Ve(a.elapsedMs)}${a.done<a.total?` • ETA ${Ve(v)}`:""}`},[a,h]);g.useEffect(()=>{a&&a.done>=a.total&&l(null)},[a]);const j=g.useCallback(async()=>{if(!(!e.length||d.current)){d.current=!0;try{n(!0),l({done:0,total:e.length,elapsedMs:0,pct:0});const{exportCardsToPdf:v}=await rr(async()=>{const{exportCardsToPdf:S}=await import("./pdf-DYQjO8b9.js");return{exportCardsToPdf:S}},__vite__mapDeps([0,1,2,3]));await v(e,void 0,s,{size:W,format:c,quality:Math.min(.95,Math.max(.5,u/100)),onProgress:S=>l(S)},t)}finally{n(!1),d.current=!1}}},[e,s,c,u,t]);return r.jsxs("section",{className:"space-y-3",children:[r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:e.map(v=>r.jsx(Er,{photo:v},v.id))}),e.length>0&&r.jsxs(jt,{className:"p-4",children:[r.jsx("div",{className:"mb-3 text-sm font-medium",children:"Export the collection to PDF"}),a&&r.jsxs(r.Fragment,{children:[r.jsx(Nt,{value:h,className:"mb-1 h-2"}),r.jsx("div",{className:"mb-3 text-xs opacity-70",children:P})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"opacity-70",children:"Format"}),r.jsxs(Ct,{value:c,onValueChange:v=>m(v),children:[r.jsx(Ce,{className:"w-28 h-8",children:r.jsx(Rt,{placeholder:"Format"})}),r.jsxs(Re,{children:[r.jsx(re,{value:"jpeg",children:"JPEG (small)"}),r.jsx(re,{value:"png",children:"PNG (lossless)"})]})]})]}),c==="jpeg"&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"opacity-70",children:"Quality"}),r.jsx("input",{type:"range",min:50,max:95,step:5,value:u,onChange:v=>x(Number(v.target.value))}),r.jsxs("span",{className:"tabular-nums",children:[u,"%"]})]}),r.jsx("div",{className:"grow"}),r.jsx(G,{type:"button",size:"sm",onClick:j,disabled:!e.length||o,children:o?"Exporting…":"Export PDF"})]})]})]})}function Lr(){return is(),r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"sticky top-0 z-10 w-full py-3 text-center text-3xl font-bold bg-background border-b border-gray-300",children:"Story Squares v1.0"}),r.jsxs("main",{className:"mx-auto max-w-screen-md px-4 space-y-5",children:[r.jsx(er,{}),r.jsx(Tr,{})]})]})}Vt.createRoot(document.getElementById("root")).render(r.jsx(g.StrictMode,{children:r.jsx(Lr,{})}));export{W as C,J as D,Xs as P,ur as d,gr as e};
