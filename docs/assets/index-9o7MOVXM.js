const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdf-BXeXHJNn.js","assets/pdf-lib-F-JeKLTy.js","assets/vendor-react-CQrsTYwo.js","assets/vendor-ui-Tl69VNYc.js"])))=>i.map(i=>d[i]);
import{r as h,j as o,k as At,R as Ft,C as Ge,m as Bt,n as Ut,X as Dt,S as $t,L as _t,I as Gt,T as Ot,p as Vt,q as Ht}from"./vendor-react-CQrsTYwo.js";import{S as Wt,R as Oe,I as Xt,T as Ve,a as qt,b as He,c as We,P as Yt,C as Xe,V as Qt,L as qe,d as Ye,e as Zt,f as Jt,g as Qe,h as Kt,i as er,O as Ze,j as tr,k as Je,l as rr,m as Ke,D as et,n as sr,o as tt,p as rt,q as or,r as nr,s as ar,t as ir}from"./vendor-ui-Tl69VNYc.js";import"./pdf-lib-F-JeKLTy.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();function fe(e){const r=document.documentElement,t=window.matchMedia("(prefers-color-scheme: dark)").matches,s=e==="dark"||e==="system"&&t;r.classList.toggle("dark",s)}function lr(){h.useEffect(()=>{const e=localStorage.getItem("theme")??"system";fe(e);const r=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{const n=localStorage.getItem("theme")??"system";n==="system"&&fe(n)};r.addEventListener("change",t);const s=n=>{if(n.key==="theme"){const a=n.newValue??"system";fe(a)}};return window.addEventListener("storage",s),()=>{r.removeEventListener("change",t),window.removeEventListener("storage",s)}},[])}function st(e){var r,t,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var n=e.length;for(r=0;r<n;r++)e[r]&&(t=st(e[r]))&&(s&&(s+=" "),s+=t)}else for(t in e)e[t]&&(s&&(s+=" "),s+=t);return s}function ot(){for(var e,r,t=0,s="",n=arguments.length;t<n;t++)(e=arguments[t])&&(r=st(e))&&(s&&(s+=" "),s+=r);return s}const Le=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,Te=ot,nt=(e,r)=>t=>{var s;if(r?.variants==null)return Te(e,t?.class,t?.className);const{variants:n,defaultVariants:a}=r,i=Object.keys(n).map(d=>{const p=t?.[d],f=a?.[d];if(p===null)return null;const x=Le(p)||Le(f);return n[d][x]}),l=t&&Object.entries(t).reduce((d,p)=>{let[f,x]=p;return x===void 0||(d[f]=x),d},{}),c=r==null||(s=r.compoundVariants)===null||s===void 0?void 0:s.reduce((d,p)=>{let{class:f,className:x,...S}=p;return Object.entries(S).every(j=>{let[v,z]=j;return Array.isArray(z)?z.includes({...a,...l}[v]):{...a,...l}[v]===z})?[...d,f,x]:d},[]);return Te(e,i,c,t?.class,t?.className)},ke="-",cr=e=>{const r=ur(e),{conflictingClassGroups:t,conflictingClassGroupModifiers:s}=e;return{getClassGroupId:i=>{const l=i.split(ke);return l[0]===""&&l.length!==1&&l.shift(),at(l,r)||dr(i)},getConflictingClassGroupIds:(i,l)=>{const c=t[i]||[];return l&&s[i]?[...c,...s[i]]:c}}},at=(e,r)=>{if(e.length===0)return r.classGroupId;const t=e[0],s=r.nextPart.get(t),n=s?at(e.slice(1),s):void 0;if(n)return n;if(r.validators.length===0)return;const a=e.join(ke);return r.validators.find(({validator:i})=>i(a))?.classGroupId},Ie=/^\[(.+)\]$/,dr=e=>{if(Ie.test(e)){const r=Ie.exec(e)[1],t=r?.substring(0,r.indexOf(":"));if(t)return"arbitrary.."+t}},ur=e=>{const{theme:r,classGroups:t}=e,s={nextPart:new Map,validators:[]};for(const n in t)be(t[n],s,n,r);return s},be=(e,r,t,s)=>{e.forEach(n=>{if(typeof n=="string"){const a=n===""?r:Ae(r,n);a.classGroupId=t;return}if(typeof n=="function"){if(mr(n)){be(n(s),r,t,s);return}r.validators.push({validator:n,classGroupId:t});return}Object.entries(n).forEach(([a,i])=>{be(i,Ae(r,a),t,s)})})},Ae=(e,r)=>{let t=e;return r.split(ke).forEach(s=>{t.nextPart.has(s)||t.nextPart.set(s,{nextPart:new Map,validators:[]}),t=t.nextPart.get(s)}),t},mr=e=>e.isThemeGetter,fr=e=>{if(e<1)return{get:()=>{},set:()=>{}};let r=0,t=new Map,s=new Map;const n=(a,i)=>{t.set(a,i),r++,r>e&&(r=0,s=t,t=new Map)};return{get(a){let i=t.get(a);if(i!==void 0)return i;if((i=s.get(a))!==void 0)return n(a,i),i},set(a,i){t.has(a)?t.set(a,i):n(a,i)}}},ye="!",we=":",pr=we.length,gr=e=>{const{prefix:r,experimentalParseClassName:t}=e;let s=n=>{const a=[];let i=0,l=0,c=0,d;for(let j=0;j<n.length;j++){let v=n[j];if(i===0&&l===0){if(v===we){a.push(n.slice(c,j)),c=j+pr;continue}if(v==="/"){d=j;continue}}v==="["?i++:v==="]"?i--:v==="("?l++:v===")"&&l--}const p=a.length===0?n:n.substring(c),f=hr(p),x=f!==p,S=d&&d>c?d-c:void 0;return{modifiers:a,hasImportantModifier:x,baseClassName:f,maybePostfixModifierPosition:S}};if(r){const n=r+we,a=s;s=i=>i.startsWith(n)?a(i.substring(n.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:i,maybePostfixModifierPosition:void 0}}if(t){const n=s;s=a=>t({className:a,parseClassName:n})}return s},hr=e=>e.endsWith(ye)?e.substring(0,e.length-1):e.startsWith(ye)?e.substring(1):e,xr=e=>{const r=Object.fromEntries(e.orderSensitiveModifiers.map(s=>[s,!0]));return s=>{if(s.length<=1)return s;const n=[];let a=[];return s.forEach(i=>{i[0]==="["||r[i]?(n.push(...a.sort(),i),a=[]):a.push(i)}),n.push(...a.sort()),n}},br=e=>({cache:fr(e.cacheSize),parseClassName:gr(e),sortModifiers:xr(e),...cr(e)}),yr=/\s+/,wr=(e,r)=>{const{parseClassName:t,getClassGroupId:s,getConflictingClassGroupIds:n,sortModifiers:a}=r,i=[],l=e.trim().split(yr);let c="";for(let d=l.length-1;d>=0;d-=1){const p=l[d],{isExternal:f,modifiers:x,hasImportantModifier:S,baseClassName:j,maybePostfixModifierPosition:v}=t(p);if(f){c=p+(c.length>0?" "+c:c);continue}let z=!!v,N=s(z?j.substring(0,v):j);if(!N){if(!z){c=p+(c.length>0?" "+c:c);continue}if(N=s(j),!N){c=p+(c.length>0?" "+c:c);continue}z=!1}const M=a(x).join(":"),u=S?M+ye:M,g=u+N;if(i.includes(g))continue;i.push(g);const R=n(N,z);for(let m=0;m<R.length;++m){const b=R[m];i.push(u+b)}c=p+(c.length>0?" "+c:c)}return c};function vr(){let e=0,r,t,s="";for(;e<arguments.length;)(r=arguments[e++])&&(t=it(r))&&(s&&(s+=" "),s+=t);return s}const it=e=>{if(typeof e=="string")return e;let r,t="";for(let s=0;s<e.length;s++)e[s]&&(r=it(e[s]))&&(t&&(t+=" "),t+=r);return t};function kr(e,...r){let t,s,n,a=i;function i(c){const d=r.reduce((p,f)=>f(p),e());return t=br(d),s=t.cache.get,n=t.cache.set,a=l,l(c)}function l(c){const d=s(c);if(d)return d;const p=wr(c,t);return n(c,p),p}return function(){return a(vr.apply(null,arguments))}}const A=e=>{const r=t=>t[e]||[];return r.isThemeGetter=!0,r},lt=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,ct=/^\((?:(\w[\w-]*):)?(.+)\)$/i,jr=/^\d+\/\d+$/,Nr=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Cr=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Rr=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,Sr=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Pr=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,J=e=>jr.test(e),P=e=>!!e&&!Number.isNaN(Number(e)),q=e=>!!e&&Number.isInteger(Number(e)),pe=e=>e.endsWith("%")&&P(e.slice(0,-1)),X=e=>Nr.test(e),zr=()=>!0,Mr=e=>Cr.test(e)&&!Rr.test(e),dt=()=>!1,Er=e=>Sr.test(e),Lr=e=>Pr.test(e),Tr=e=>!y(e)&&!w(e),Ir=e=>K(e,ft,dt),y=e=>lt.test(e),Q=e=>K(e,pt,Mr),ge=e=>K(e,Dr,P),Fe=e=>K(e,ut,dt),Ar=e=>K(e,mt,Lr),ae=e=>K(e,gt,Er),w=e=>ct.test(e),te=e=>ee(e,pt),Fr=e=>ee(e,$r),Be=e=>ee(e,ut),Br=e=>ee(e,ft),Ur=e=>ee(e,mt),ie=e=>ee(e,gt,!0),K=(e,r,t)=>{const s=lt.exec(e);return s?s[1]?r(s[1]):t(s[2]):!1},ee=(e,r,t=!1)=>{const s=ct.exec(e);return s?s[1]?r(s[1]):t:!1},ut=e=>e==="position"||e==="percentage",mt=e=>e==="image"||e==="url",ft=e=>e==="length"||e==="size"||e==="bg-size",pt=e=>e==="length",Dr=e=>e==="number",$r=e=>e==="family-name",gt=e=>e==="shadow",_r=()=>{const e=A("color"),r=A("font"),t=A("text"),s=A("font-weight"),n=A("tracking"),a=A("leading"),i=A("breakpoint"),l=A("container"),c=A("spacing"),d=A("radius"),p=A("shadow"),f=A("inset-shadow"),x=A("text-shadow"),S=A("drop-shadow"),j=A("blur"),v=A("perspective"),z=A("aspect"),N=A("ease"),M=A("animate"),u=()=>["auto","avoid","all","avoid-page","page","left","right","column"],g=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],R=()=>[...g(),w,y],m=()=>["auto","hidden","clip","visible","scroll"],b=()=>["auto","contain","none"],k=()=>[w,y,c],I=()=>[J,"full","auto",...k()],O=()=>[q,"none","subgrid",w,y],Y=()=>["auto",{span:["full",q,w,y]},q,w,y],H=()=>[q,"auto",w,y],V=()=>["auto","min","max","fr",w,y],E=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],G=()=>["start","end","center","stretch","center-safe","end-safe"],B=()=>["auto",...k()],W=()=>[J,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...k()],C=()=>[e,w,y],Se=()=>[...g(),Be,Fe,{position:[w,y]}],Pe=()=>["no-repeat",{repeat:["","x","y","space","round"]}],ze=()=>["auto","cover","contain",Br,Ir,{size:[w,y]}],ue=()=>[pe,te,Q],U=()=>["","none","full",d,w,y],$=()=>["",P,te,Q],re=()=>["solid","dashed","dotted","double"],Me=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],F=()=>[P,pe,Be,Fe],Ee=()=>["","none",j,w,y],se=()=>["none",P,w,y],oe=()=>["none",P,w,y],me=()=>[P,w,y],ne=()=>[J,"full",...k()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[X],breakpoint:[X],color:[zr],container:[X],"drop-shadow":[X],ease:["in","out","in-out"],font:[Tr],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[X],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[X],shadow:[X],spacing:["px",P],text:[X],"text-shadow":[X],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",J,y,w,z]}],container:["container"],columns:[{columns:[P,y,w,l]}],"break-after":[{"break-after":u()}],"break-before":[{"break-before":u()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:R()}],overflow:[{overflow:m()}],"overflow-x":[{"overflow-x":m()}],"overflow-y":[{"overflow-y":m()}],overscroll:[{overscroll:b()}],"overscroll-x":[{"overscroll-x":b()}],"overscroll-y":[{"overscroll-y":b()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:I()}],"inset-x":[{"inset-x":I()}],"inset-y":[{"inset-y":I()}],start:[{start:I()}],end:[{end:I()}],top:[{top:I()}],right:[{right:I()}],bottom:[{bottom:I()}],left:[{left:I()}],visibility:["visible","invisible","collapse"],z:[{z:[q,"auto",w,y]}],basis:[{basis:[J,"full","auto",l,...k()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[P,J,"auto","initial","none",y]}],grow:[{grow:["",P,w,y]}],shrink:[{shrink:["",P,w,y]}],order:[{order:[q,"first","last","none",w,y]}],"grid-cols":[{"grid-cols":O()}],"col-start-end":[{col:Y()}],"col-start":[{"col-start":H()}],"col-end":[{"col-end":H()}],"grid-rows":[{"grid-rows":O()}],"row-start-end":[{row:Y()}],"row-start":[{"row-start":H()}],"row-end":[{"row-end":H()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":V()}],"auto-rows":[{"auto-rows":V()}],gap:[{gap:k()}],"gap-x":[{"gap-x":k()}],"gap-y":[{"gap-y":k()}],"justify-content":[{justify:[...E(),"normal"]}],"justify-items":[{"justify-items":[...G(),"normal"]}],"justify-self":[{"justify-self":["auto",...G()]}],"align-content":[{content:["normal",...E()]}],"align-items":[{items:[...G(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...G(),{baseline:["","last"]}]}],"place-content":[{"place-content":E()}],"place-items":[{"place-items":[...G(),"baseline"]}],"place-self":[{"place-self":["auto",...G()]}],p:[{p:k()}],px:[{px:k()}],py:[{py:k()}],ps:[{ps:k()}],pe:[{pe:k()}],pt:[{pt:k()}],pr:[{pr:k()}],pb:[{pb:k()}],pl:[{pl:k()}],m:[{m:B()}],mx:[{mx:B()}],my:[{my:B()}],ms:[{ms:B()}],me:[{me:B()}],mt:[{mt:B()}],mr:[{mr:B()}],mb:[{mb:B()}],ml:[{ml:B()}],"space-x":[{"space-x":k()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":k()}],"space-y-reverse":["space-y-reverse"],size:[{size:W()}],w:[{w:[l,"screen",...W()]}],"min-w":[{"min-w":[l,"screen","none",...W()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[i]},...W()]}],h:[{h:["screen","lh",...W()]}],"min-h":[{"min-h":["screen","lh","none",...W()]}],"max-h":[{"max-h":["screen","lh",...W()]}],"font-size":[{text:["base",t,te,Q]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,w,ge]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",pe,y]}],"font-family":[{font:[Fr,y,r]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,w,y]}],"line-clamp":[{"line-clamp":[P,"none",w,ge]}],leading:[{leading:[a,...k()]}],"list-image":[{"list-image":["none",w,y]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",w,y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:C()}],"text-color":[{text:C()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...re(),"wavy"]}],"text-decoration-thickness":[{decoration:[P,"from-font","auto",w,Q]}],"text-decoration-color":[{decoration:C()}],"underline-offset":[{"underline-offset":[P,"auto",w,y]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:k()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",w,y]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",w,y]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Se()}],"bg-repeat":[{bg:Pe()}],"bg-size":[{bg:ze()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},q,w,y],radial:["",w,y],conic:[q,w,y]},Ur,Ar]}],"bg-color":[{bg:C()}],"gradient-from-pos":[{from:ue()}],"gradient-via-pos":[{via:ue()}],"gradient-to-pos":[{to:ue()}],"gradient-from":[{from:C()}],"gradient-via":[{via:C()}],"gradient-to":[{to:C()}],rounded:[{rounded:U()}],"rounded-s":[{"rounded-s":U()}],"rounded-e":[{"rounded-e":U()}],"rounded-t":[{"rounded-t":U()}],"rounded-r":[{"rounded-r":U()}],"rounded-b":[{"rounded-b":U()}],"rounded-l":[{"rounded-l":U()}],"rounded-ss":[{"rounded-ss":U()}],"rounded-se":[{"rounded-se":U()}],"rounded-ee":[{"rounded-ee":U()}],"rounded-es":[{"rounded-es":U()}],"rounded-tl":[{"rounded-tl":U()}],"rounded-tr":[{"rounded-tr":U()}],"rounded-br":[{"rounded-br":U()}],"rounded-bl":[{"rounded-bl":U()}],"border-w":[{border:$()}],"border-w-x":[{"border-x":$()}],"border-w-y":[{"border-y":$()}],"border-w-s":[{"border-s":$()}],"border-w-e":[{"border-e":$()}],"border-w-t":[{"border-t":$()}],"border-w-r":[{"border-r":$()}],"border-w-b":[{"border-b":$()}],"border-w-l":[{"border-l":$()}],"divide-x":[{"divide-x":$()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":$()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...re(),"hidden","none"]}],"divide-style":[{divide:[...re(),"hidden","none"]}],"border-color":[{border:C()}],"border-color-x":[{"border-x":C()}],"border-color-y":[{"border-y":C()}],"border-color-s":[{"border-s":C()}],"border-color-e":[{"border-e":C()}],"border-color-t":[{"border-t":C()}],"border-color-r":[{"border-r":C()}],"border-color-b":[{"border-b":C()}],"border-color-l":[{"border-l":C()}],"divide-color":[{divide:C()}],"outline-style":[{outline:[...re(),"none","hidden"]}],"outline-offset":[{"outline-offset":[P,w,y]}],"outline-w":[{outline:["",P,te,Q]}],"outline-color":[{outline:C()}],shadow:[{shadow:["","none",p,ie,ae]}],"shadow-color":[{shadow:C()}],"inset-shadow":[{"inset-shadow":["none",f,ie,ae]}],"inset-shadow-color":[{"inset-shadow":C()}],"ring-w":[{ring:$()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:C()}],"ring-offset-w":[{"ring-offset":[P,Q]}],"ring-offset-color":[{"ring-offset":C()}],"inset-ring-w":[{"inset-ring":$()}],"inset-ring-color":[{"inset-ring":C()}],"text-shadow":[{"text-shadow":["none",x,ie,ae]}],"text-shadow-color":[{"text-shadow":C()}],opacity:[{opacity:[P,w,y]}],"mix-blend":[{"mix-blend":[...Me(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Me()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[P]}],"mask-image-linear-from-pos":[{"mask-linear-from":F()}],"mask-image-linear-to-pos":[{"mask-linear-to":F()}],"mask-image-linear-from-color":[{"mask-linear-from":C()}],"mask-image-linear-to-color":[{"mask-linear-to":C()}],"mask-image-t-from-pos":[{"mask-t-from":F()}],"mask-image-t-to-pos":[{"mask-t-to":F()}],"mask-image-t-from-color":[{"mask-t-from":C()}],"mask-image-t-to-color":[{"mask-t-to":C()}],"mask-image-r-from-pos":[{"mask-r-from":F()}],"mask-image-r-to-pos":[{"mask-r-to":F()}],"mask-image-r-from-color":[{"mask-r-from":C()}],"mask-image-r-to-color":[{"mask-r-to":C()}],"mask-image-b-from-pos":[{"mask-b-from":F()}],"mask-image-b-to-pos":[{"mask-b-to":F()}],"mask-image-b-from-color":[{"mask-b-from":C()}],"mask-image-b-to-color":[{"mask-b-to":C()}],"mask-image-l-from-pos":[{"mask-l-from":F()}],"mask-image-l-to-pos":[{"mask-l-to":F()}],"mask-image-l-from-color":[{"mask-l-from":C()}],"mask-image-l-to-color":[{"mask-l-to":C()}],"mask-image-x-from-pos":[{"mask-x-from":F()}],"mask-image-x-to-pos":[{"mask-x-to":F()}],"mask-image-x-from-color":[{"mask-x-from":C()}],"mask-image-x-to-color":[{"mask-x-to":C()}],"mask-image-y-from-pos":[{"mask-y-from":F()}],"mask-image-y-to-pos":[{"mask-y-to":F()}],"mask-image-y-from-color":[{"mask-y-from":C()}],"mask-image-y-to-color":[{"mask-y-to":C()}],"mask-image-radial":[{"mask-radial":[w,y]}],"mask-image-radial-from-pos":[{"mask-radial-from":F()}],"mask-image-radial-to-pos":[{"mask-radial-to":F()}],"mask-image-radial-from-color":[{"mask-radial-from":C()}],"mask-image-radial-to-color":[{"mask-radial-to":C()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":g()}],"mask-image-conic-pos":[{"mask-conic":[P]}],"mask-image-conic-from-pos":[{"mask-conic-from":F()}],"mask-image-conic-to-pos":[{"mask-conic-to":F()}],"mask-image-conic-from-color":[{"mask-conic-from":C()}],"mask-image-conic-to-color":[{"mask-conic-to":C()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Se()}],"mask-repeat":[{mask:Pe()}],"mask-size":[{mask:ze()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",w,y]}],filter:[{filter:["","none",w,y]}],blur:[{blur:Ee()}],brightness:[{brightness:[P,w,y]}],contrast:[{contrast:[P,w,y]}],"drop-shadow":[{"drop-shadow":["","none",S,ie,ae]}],"drop-shadow-color":[{"drop-shadow":C()}],grayscale:[{grayscale:["",P,w,y]}],"hue-rotate":[{"hue-rotate":[P,w,y]}],invert:[{invert:["",P,w,y]}],saturate:[{saturate:[P,w,y]}],sepia:[{sepia:["",P,w,y]}],"backdrop-filter":[{"backdrop-filter":["","none",w,y]}],"backdrop-blur":[{"backdrop-blur":Ee()}],"backdrop-brightness":[{"backdrop-brightness":[P,w,y]}],"backdrop-contrast":[{"backdrop-contrast":[P,w,y]}],"backdrop-grayscale":[{"backdrop-grayscale":["",P,w,y]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[P,w,y]}],"backdrop-invert":[{"backdrop-invert":["",P,w,y]}],"backdrop-opacity":[{"backdrop-opacity":[P,w,y]}],"backdrop-saturate":[{"backdrop-saturate":[P,w,y]}],"backdrop-sepia":[{"backdrop-sepia":["",P,w,y]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":k()}],"border-spacing-x":[{"border-spacing-x":k()}],"border-spacing-y":[{"border-spacing-y":k()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",w,y]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[P,"initial",w,y]}],ease:[{ease:["linear","initial",N,w,y]}],delay:[{delay:[P,w,y]}],animate:[{animate:["none",M,w,y]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[v,w,y]}],"perspective-origin":[{"perspective-origin":R()}],rotate:[{rotate:se()}],"rotate-x":[{"rotate-x":se()}],"rotate-y":[{"rotate-y":se()}],"rotate-z":[{"rotate-z":se()}],scale:[{scale:oe()}],"scale-x":[{"scale-x":oe()}],"scale-y":[{"scale-y":oe()}],"scale-z":[{"scale-z":oe()}],"scale-3d":["scale-3d"],skew:[{skew:me()}],"skew-x":[{"skew-x":me()}],"skew-y":[{"skew-y":me()}],transform:[{transform:[w,y,"","none","gpu","cpu"]}],"transform-origin":[{origin:R()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:ne()}],"translate-x":[{"translate-x":ne()}],"translate-y":[{"translate-y":ne()}],"translate-z":[{"translate-z":ne()}],"translate-none":["translate-none"],accent:[{accent:C()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:C()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",w,y]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":k()}],"scroll-mx":[{"scroll-mx":k()}],"scroll-my":[{"scroll-my":k()}],"scroll-ms":[{"scroll-ms":k()}],"scroll-me":[{"scroll-me":k()}],"scroll-mt":[{"scroll-mt":k()}],"scroll-mr":[{"scroll-mr":k()}],"scroll-mb":[{"scroll-mb":k()}],"scroll-ml":[{"scroll-ml":k()}],"scroll-p":[{"scroll-p":k()}],"scroll-px":[{"scroll-px":k()}],"scroll-py":[{"scroll-py":k()}],"scroll-ps":[{"scroll-ps":k()}],"scroll-pe":[{"scroll-pe":k()}],"scroll-pt":[{"scroll-pt":k()}],"scroll-pr":[{"scroll-pr":k()}],"scroll-pb":[{"scroll-pb":k()}],"scroll-pl":[{"scroll-pl":k()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",w,y]}],fill:[{fill:["none",...C()]}],"stroke-w":[{stroke:[P,te,Q,ge]}],stroke:[{stroke:["none",...C()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Gr=kr(_r);function T(...e){return Gr(ot(e))}const Or=nt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),D=h.forwardRef(({className:e,variant:r,size:t,asChild:s=!1,...n},a)=>{const i=s?Wt:"button";return o.jsx(i,{className:T(Or({variant:r,size:t,className:e})),ref:a,...n})});D.displayName="Button";const Vr=/^(image\/(jpeg|png|webp|gif|avif|bmp|tiff))$/i;function Hr(e){return Vr.test(e.type)}function Wr(e,r=36){const t=[];for(const s of e)if(Hr(s)){if(t.length>=r)break;t.push({id:crypto.randomUUID(),url:URL.createObjectURL(s),name:s.name,size:s.size,type:s.type})}return t}function Ue(e){for(const r of e)try{URL.revokeObjectURL(r.url)}catch{}}const Xr=16,_=2050,le=1024,qr=.8,ht="contain",Yr="left",Qr="top",xt=[{id:"georgia",label:"Georgia",family:"Georgia, serif"},{id:"times",label:"Times",family:'"Times New Roman", Times, serif'},{id:"garamond",label:"Garamond",family:"Garamond, serif"}],Z={scale:1,tx:0,ty:0},he=(e,r,t)=>Math.max(r,Math.min(t,e));function Zr(e){return new Promise((r,t)=>{const s=new Image;s.onload=()=>r({w:s.naturalWidth,h:s.naturalHeight}),s.onerror=t,s.src=e})}function Jr(e,r,t,s,n,a){const i=t/e,l=t/r,c=Math.min(i,l),d=e*c,p=r*c,f=0,x=0,S=(f-(t-d)/2)/t*100,j=(x-(t-p)/2)/t*100;return{tx:Math.max(-100,Math.min(100,S)),ty:Math.max(-100,Math.min(100,j))}}const L=At((e,r)=>({photos:[],max:Xr,transforms:{},layersByPhoto:{},setTransform:(t,s)=>e(n=>{const a=n.transforms[t]??Z,i={scale:he(s.scale??a.scale,.5,4),tx:he(s.tx??a.tx,-100,100),ty:he(s.ty??a.ty,-100,100)};return{transforms:{...n.transforms,[t]:i}}}),resetTransform:t=>e(s=>{const{[t]:n,...a}=s.transforms;return{transforms:a}}),add:t=>{if(!t?.length)return;const{photos:s,max:n}=r(),a=Math.max(0,n-s.length);if(!a)return;const i=t.slice(0,a);e({photos:[...s,...i]});for(const l of i)(async()=>{try{const{w:c,h:d}=await Zr(l.url),{tx:p,ty:f}=Jr(c,d,_,ht,Yr,Qr);r().setTransform(l.id,{tx:p,ty:f})}catch{}})()},clear:()=>{const t=r().photos;t.length&&Ue(t),e({photos:[],transforms:{},layersByPhoto:{}})},remove:t=>e(s=>{const n=s.photos.findIndex(c=>c.id===t);if(n===-1)return null;Ue([s.photos[n]]);const{[t]:a,...i}=s.transforms,l={...s.layersByPhoto};return delete l[t],{photos:s.photos.filter(c=>c.id!==t),transforms:i,layersByPhoto:l}}),addTextLayer:(t,s={})=>{const n=crypto.randomUUID();return e(a=>{const i=a.layersByPhoto[t]??[],l=i.length?Math.max(...i.map(p=>p.z))+1:1,c={...s};delete c.id,delete c.type,delete c.z;const d={id:n,type:"text",x:40,y:_-140,rotation:0,scaleX:1,scaleY:1,visible:!0,z:l,text:"New text",fontFamily:"Georgia, serif",fontSize:36,fontStyle:"",fill:"#111",align:"left",verticalAlign:"top",padding:0,lineHeight:1.25,letterSpacing:0,...c};return{layersByPhoto:{...a.layersByPhoto,[t]:[...i,d]}}}),n},updateLayer:(t,s,n)=>e(a=>{const i=a.layersByPhoto[t]??[],l=i.findIndex(x=>x.id===s);if(l===-1)return null;const c=i[l],d={...n};delete d.id,delete d.type;const p={...c,...d},f=[...i];return f[l]=p,{layersByPhoto:{...a.layersByPhoto,[t]:f}}}),removeLayer:(t,s)=>e(n=>{const a=n.layersByPhoto[t]??[],i=a.filter(l=>l.id!==s);return i===a?null:{layersByPhoto:{...n.layersByPhoto,[t]:i}}}),bringToFront:(t,s)=>e(n=>{const a=n.layersByPhoto[t]??[];if(!a.length)return null;const i=Math.max(...a.map(c=>c.z)),l=a.map(c=>c.id===s?{...c,z:i+1}:c);return{layersByPhoto:{...n.layersByPhoto,[t]:l}}}),sendToBack:(t,s)=>e(n=>{const a=n.layersByPhoto[t]??[];if(!a.length)return null;const i=Math.min(...a.map(c=>c.z)),l=a.map(c=>c.id===s?{...c,z:i-1}:c);return{layersByPhoto:{...n.layersByPhoto,[t]:l}}}),setLayersOrder:(t,s)=>e(n=>{const a=n.layersByPhoto[t]??[];if(!a.length)return null;const i=new Map(a.map(d=>[d.id,d])),l=[];let c=1;for(const d of s){const p=i.get(d);p&&l.push({...p,z:c++})}for(const d of a)s.includes(d.id)||l.push({...d,z:c++});return{layersByPhoto:{...n.layersByPhoto,[t]:l}}})}));function Kr(e){const r=e.replace(/^\uFEFF/,"").replace(/\r\n?/g,`
`).split(`
`).filter(Boolean);if(!r.length)return{rows:[],hasRelative:!1};const t=r[0].toLowerCase(),s=t.includes(";")&&!t.includes(",")?";":",",n=[],a=new RegExp(`\\s*(?:"([^"]*)"|([^${s}\\n]*))\\s*(?:${s}|$)`,"g");for(const l of r){const c=[];a.lastIndex=0;let d,p=0;for(;(d=a.exec(l))&&p++<1e3;){const S=(d[1]??d[2]??"").trim();if(c.push(S),d.index+d[0].length>=l.length)break}if(!c.length)continue;const f=(c[0]??"").trim();if(!f)continue;const x=(c[1]??"").trim()||void 0;n.push({url:f,caption:x})}n.length&&n[0].url.trim().toLowerCase()==="url"&&n.shift();const i=n.some(l=>es(l.url));return{rows:n,hasRelative:i}}function bt(e){return/^https?:\/\//i.test(e)}function yt(e){return/^data:/i.test(e)}function es(e){return!(bt(e)||yt(e)||/^blob:/.test(e))}function ts(){const e=h.useRef(null),r=Ft.useRef(null),t=L(f=>f.photos),s=L(f=>f.max),n=L(f=>f.add),a=L(f=>f.clear),i=Math.max(0,s-t.length),l=h.useCallback(f=>{if(!f?.length)return;const x=Array.from(f).slice(0,i),S=Wr(x,i);n(S)},[n,i]),c=h.useCallback(f=>{l(f.target.files),f.target.value=""},[l]);async function d(f){const x=f.target.files?.[0];if(!x)return;const S=await x.text();f.target.value="";const{rows:j,hasRelative:v}=Kr(S);if(j.length){if(v){alert("В этом CSV есть относительные пути. В текущей сборке локальная папка не поддерживается. Пожалуйста, используйте полные URL (http/https) или добавьте изображения кнопкой “Choose images”.");return}await p(j)}}async function p(f,x){const S=L.getState().add,j=[];let v=0,z=0;for(const N of f)try{let M=null,u="image";if(bt(N.url)){const m=await fetch(N.url,{mode:"cors"});if(!m.ok)throw new Error(`HTTP ${m.status}`);M=await m.blob(),u=N.url.split("/").pop()||u}else if(yt(N.url))M=await(await fetch(N.url)).blob(),u="data.png";else throw new Error("Relative paths are disabled in this build");const g=URL.createObjectURL(M),R=crypto.randomUUID();j.push({id:R,url:g,name:u}),v++}catch(M){console.warn("CSV import skip:",N.url,M),z++}S(j),z&&alert(`CSV import: added ${v}, skipped ${z}`)}return o.jsx("section",{className:"mt-4 space-y-4",children:o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsxs("div",{className:"text-sm opacity-80",children:["Cards: ",o.jsx("b",{children:t.length})," / ",s]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{ref:e,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:c}),o.jsx("input",{ref:r,type:"file",accept:".csv,text/csv",className:"hidden",onChange:d}),o.jsx("button",{onClick:()=>r.current?.click(),className:"rounded-md bg-background/80 px-3 py-2 text-sm shadow hover:bg-background",children:"Import CSV"}),o.jsx("button",{onClick:()=>e.current?.click(),className:"rounded-md bg-background/80 px-3 py-2 text-sm shadow hover:bg-background",children:"Choose images"}),o.jsx(D,{variant:"destructive",onClick:a,disabled:!t.length,children:"Clear"})]})]})})}const rs="modulepreload",ss=function(e){return"/ss/"+e},De={},os=function(r,t,s){let n=Promise.resolve();if(t&&t.length>0){let c=function(d){return Promise.all(d.map(p=>Promise.resolve(p).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=i?.nonce||i?.getAttribute("nonce");n=c(t.map(d=>{if(d=ss(d),d in De)return;De[d]=!0;const p=d.endsWith(".css"),f=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${f}`))return;const x=document.createElement("link");if(x.rel=p?"stylesheet":rs,p||(x.as="script"),x.crossOrigin="",x.href=d,l&&x.setAttribute("nonce",l),document.head.appendChild(x),p)return new Promise((S,j)=>{x.addEventListener("load",S),x.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return n.then(i=>{for(const l of i||[])l.status==="rejected"&&a(l.reason);return r().catch(a)})},wt=h.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:T("rounded-xl border bg-card text-card-foreground shadow",e),...r}));wt.displayName="Card";const ns=h.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:T("flex flex-col space-y-1.5 p-6",e),...r}));ns.displayName="CardHeader";const as=h.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:T("font-semibold leading-none tracking-tight",e),...r}));as.displayName="CardTitle";const is=h.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:T("text-sm text-muted-foreground",e),...r}));is.displayName="CardDescription";const ls=h.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:T("p-6 pt-0",e),...r}));ls.displayName="CardContent";const cs=h.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:T("flex items-center p-6 pt-0",e),...r}));cs.displayName="CardFooter";const vt=h.forwardRef(({className:e,value:r,...t},s)=>o.jsx(Oe,{ref:s,className:T("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...t,children:o.jsx(Xt,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));vt.displayName=Oe.displayName;const ds=Kt,us=er,kt=h.forwardRef(({className:e,children:r,...t},s)=>o.jsxs(Ve,{ref:s,className:T("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...t,children:[r,o.jsx(qt,{asChild:!0,children:o.jsx(Ge,{className:"h-4 w-4 opacity-50"})})]}));kt.displayName=Ve.displayName;const jt=h.forwardRef(({className:e,...r},t)=>o.jsx(He,{ref:t,className:T("flex cursor-default items-center justify-center py-1",e),...r,children:o.jsx(Bt,{className:"h-4 w-4"})}));jt.displayName=He.displayName;const Nt=h.forwardRef(({className:e,...r},t)=>o.jsx(We,{ref:t,className:T("flex cursor-default items-center justify-center py-1",e),...r,children:o.jsx(Ge,{className:"h-4 w-4"})}));Nt.displayName=We.displayName;const Ct=h.forwardRef(({className:e,children:r,position:t="popper",...s},n)=>o.jsx(Yt,{children:o.jsxs(Xe,{ref:n,className:T("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t,...s,children:[o.jsx(jt,{}),o.jsx(Qt,{className:T("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),o.jsx(Nt,{})]})}));Ct.displayName=Xe.displayName;const ms=h.forwardRef(({className:e,...r},t)=>o.jsx(qe,{ref:t,className:T("px-2 py-1.5 text-sm font-semibold",e),...r}));ms.displayName=qe.displayName;const ve=h.forwardRef(({className:e,children:r,...t},s)=>o.jsxs(Ye,{ref:s,className:T("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[o.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:o.jsx(Zt,{children:o.jsx(Ut,{className:"h-4 w-4"})})}),o.jsx(Jt,{children:r})]}));ve.displayName=Ye.displayName;const fs=h.forwardRef(({className:e,...r},t)=>o.jsx(Qe,{ref:t,className:T("-mx-1 my-1 h-px bg-muted",e),...r}));fs.displayName=Qe.displayName;function Rt(e,r,t){if(!r?.length)return;const s=t/_,n=[...r].sort((a,i)=>a.z-i.z);for(const a of n)a.visible!==!1&&a.type==="text"&&gs(e,a,s)}function ps(e,r,t,s=0){const n=[];if(!r)return n;const a=r.replace(/\r\n?/g,`
`).split(`
`),i=l=>e.measureText(l).width+Math.max(0,l.length-1)*s;for(const l of a){if(!t||t<=0){n.push(l);continue}const c=l.split(/\s+/);let d="";for(const p of c){const f=d?d+" "+p:p;if(i(f)<=t)d=f;else if(d&&n.push(d),i(p)>t){let x="";for(const S of p){const j=x+S;i(j)<=t?x=j:(x&&n.push(x),x=S)}d=x}else d=p}n.push(d)}return n}function gs(e,r,t){e.save(),e.translate(r.x*t,r.y*t),r.rotation&&e.rotate(r.rotation*Math.PI/180);const s=r.fontFamily||"system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif",n=Math.max(1,r.fontSize||16)*t,a=r.fontStyle||"",i=[];a.includes("italic")&&i.push("italic"),a.includes("bold")&&i.push("bold"),i.push(`${n}px`,s),e.font=i.join(" "),e.fontKerning="none",e.fillStyle=r.fill||"#111",e.textBaseline="top",e.textAlign="left";const l=Math.max(0,r.padding??0)*t,c=(r.width??0)>0?Math.max(0,r.width*t-l*2):void 0,d=r.align||"left",p=n*(r.lineHeight??1.25),f=(r.letterSpacing??0)*t,x=ps(e,r.text??"",c,f);let S=l;for(const j of x){let v=0;for(let M=0;M<j.length;M++){const u=j[M];v+=e.measureText(u).width,M<j.length-1&&(v+=f)}let z=l;c!==void 0&&(d==="center"?z=l+(c-v)/2:d==="right"&&(z=l+(c-v)));let N=z;for(let M=0;M<j.length;M++){const u=j[M];e.fillText(u,N,S),N+=e.measureText(u).width,M<j.length-1&&(N+=f)}S+=p}e.restore()}const $e=new Set,xe=new Map;function St(e){const r=xt.find(n=>n.family===e);if(!r||$e.has(r.family))return Promise.resolve();const t=xe.get(r.family);if(t)return t;const s=(async()=>{if(r.src?.length&&await Promise.all(r.src.map(async n=>{const a=new window.FontFace(r.family.split(",")[0].replace(/(^"|"$)/g,""),`url(${n.url})`,{style:n.style??"normal",weight:n.weight??"400",display:"swap"});await a.load(),document.fonts.add(a)})),document.fonts?.ready)try{await document.fonts.ready}catch{}$e.add(r.family),xe.delete(r.family)})();return xe.set(r.family,s),s}function Pt(e){if(!e?.length)return Promise.resolve();const r=[];for(const t of e)t.type==="text"&&t.fontFamily&&r.push(St(t.fontFamily));return Promise.all(r).then(()=>{})}async function zt(){const e=document;if(e?.fonts?.ready&&typeof e.fonts.ready.then=="function")try{await e.fonts.ready}catch{}}async function Mt(e){return new Promise((r,t)=>{const s=new Image;s.onload=()=>r(s),s.onerror=n=>t(n),s.src=e})}function hs(e,r="card"){return(e.replace(/\.[^.]+$/,"").replace(/[^a-z0-9_\-]+/gi,"_").replace(/^_+|_+$/g,"")||r).slice(0,100)}function xs(e,r){const t=document.createElement("a"),s=URL.createObjectURL(e);t.href=s,t.download=r,document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(s)}async function bs(e,r,t={}){const s=t.size??le,n=t.baseSize??_,a=await ws(e,r,{size:n,bg:t.bg,captionBg:t.captionBg,textColor:t.textColor,transform:t.transform,layers:t.layers});try{const i=await Mt(a),l=document.createElement("canvas");l.width=s,l.height=s;const c=l.getContext("2d");if(!c)throw new Error("No 2D context");c.imageSmoothingQuality="high",c.drawImage(i,0,0,s,s);const d=await new Promise((p,f)=>l.toBlob(x=>x?p(x):f(new Error("toBlob failed")),"image/png"));return URL.createObjectURL(d)}finally{URL.revokeObjectURL(a)}}async function ys(e,r,t={}){const s=t.size??_,n=t.bg??"transparent",a=t.transform??Z;await Pt(t.layers),await zt();const i=document.createElement("canvas");i.width=s,i.height=s;const l=i.getContext("2d");if(!l)throw new Error("No 2D context");n!=="transparent"&&(l.fillStyle=n,l.fillRect(0,0,s,s));const c=await Mt(e.url),d=s/c.width,p=s/c.height,x=Math.min(d,p)*a.scale,S=Math.round(c.width*x),j=Math.round(c.height*x),v=Math.round((s-S)/2+a.tx/100*s),z=Math.round((s-j)/2+a.ty/100*s);l.imageSmoothingQuality="high",l.drawImage(c,v,z,S,j),Rt(l,t.layers,s);const N=await new Promise((M,u)=>i.toBlob(g=>g?M(g):u(new Error("toBlob failed")),"image/png"));xs(N,`${hs(e.name||"card")}.png`)}async function ws(e,r,t={}){const s=t.size??_,n=t.bg??"transparent",a=t.transform??Z;await Pt(t.layers),await zt();const i=document.createElement("canvas");i.width=s,i.height=s;const l=i.getContext("2d");if(!l)throw new Error("No 2D context");n!=="transparent"&&(l.fillStyle=n,l.fillRect(0,0,s,s));const c=await async function(u){return new Promise((g,R)=>{const m=new Image;m.onload=()=>g(m),m.onerror=b=>R(b),m.src=u})}(e.url),d=s/c.width,p=s/c.height,x=Math.min(d,p)*a.scale,S=Math.round(c.width*x),j=Math.round(c.height*x),v=Math.round((s-S)/2+a.tx/100*s),z=Math.round((s-j)/2+a.ty/100*s);l.imageSmoothingQuality="high",l.drawImage(c,v,z,S,j),Rt(l,t.layers,s);const N=await new Promise((M,u)=>i.toBlob(g=>g?M(g):u(new Error("toBlob failed")),"image/png"));return URL.createObjectURL(N)}const Et=sr,vs=tr,Lt=h.forwardRef(({className:e,...r},t)=>o.jsx(Ze,{ref:t,className:T("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...r}));Lt.displayName=Ze.displayName;const je=h.forwardRef(({className:e,children:r,...t},s)=>o.jsxs(vs,{children:[o.jsx(Lt,{}),o.jsxs(Je,{ref:s,className:T("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[r,o.jsxs(rr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[o.jsx(Dt,{className:"h-4 w-4"}),o.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));je.displayName=Je.displayName;const Ne=({className:e,...r})=>o.jsx("div",{className:T("flex flex-col space-y-1.5 text-center sm:text-left",e),...r});Ne.displayName="DialogHeader";const Ce=({className:e,...r})=>o.jsx("div",{className:T("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...r});Ce.displayName="DialogFooter";const Re=h.forwardRef(({className:e,...r},t)=>o.jsx(Ke,{ref:t,className:T("text-lg font-semibold leading-none tracking-tight",e),...r}));Re.displayName=Ke.displayName;const Tt=h.forwardRef(({className:e,...r},t)=>o.jsx(et,{ref:t,className:T("text-sm text-muted-foreground",e),...r}));Tt.displayName=et.displayName;const ks=nt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ce=h.forwardRef(({className:e,...r},t)=>o.jsx(tt,{ref:t,className:T(ks(),e),...r}));ce.displayName=tt.displayName;const de=h.forwardRef(({className:e,...r},t)=>o.jsxs(rt,{ref:t,className:T("relative flex w-full touch-none select-none items-center",e),...r,children:[o.jsx(or,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:o.jsx(nr,{className:"absolute h-full bg-primary"})}),o.jsx(ar,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));de.displayName=rt.displayName;const js=[];function Ns(e,r=""){const[t,s]=h.useState(null),[n,a]=h.useState("idle");return h.useEffect(()=>{if(!e){s(null),a("idle");return}let i=!1;const l=new Image;return r&&(l.crossOrigin=r),a("loading"),l.onload=()=>{i||(s(l),a("loaded"))},l.onerror=()=>{i||(s(null),a("failed"))},l.src=e,()=>{i=!0}},[e,r]),[t,n]}const It=h.forwardRef(function({photoId:r,size:t,selectedId:s,onSelect:n},a){const l=h.useRef(null),c=L(u=>u.photos.find(g=>g.id===r)?.url),d=L(u=>u.transforms[r]??Z),[p,f]=Ns(c??"","anonymous"),x=f==="loaded";h.useImperativeHandle(a,()=>({toDataURL:u=>{const g=l.current;if(!g)return null;const R=u&&u>0?u/t:1;return g.toDataURL({pixelRatio:R,mimeType:"image/png"})},isReady:()=>!!l.current&&x}));const S=L(u=>u.layersByPhoto[r]??js,Object.is),j=L(u=>u.updateLayer),v=h.useRef(null),z=h.useRef(null);h.useEffect(()=>{const u=v.current,g=z.current;u&&g&&s&&(u.nodes([g]),u.getLayer()?.batchDraw())},[s]);const N=t/_;function M(u,g,R,m){const b=g/u.width,k=g/u.height,O=Math.min(b,k)*(m?.scale??1),Y=u.width*O,H=u.height*O,V=(g-Y)/2+(m?.tx??0)/100*g,E=(g-H)/2+(m?.ty??0)/100*g;return{x:V*N,y:E*N,width:Y*N,height:H*N}}return o.jsx($t,{ref:l,width:t,height:t,pixelRatio:1,listening:!0,style:{width:"100%",height:"100%"},onMouseDown:u=>{u.target===u.target.getStage()&&n(null)},onTouchStart:u=>{u.target===u.target.getStage()&&n(null)},children:o.jsxs(_t,{children:[p?o.jsx(Gt,{image:p,...M(p,_,ht,d),listening:!1}):null,S.slice().sort((u,g)=>u.z-g.z).map(u=>{if(u.type!=="text")return null;const g=u,m=s===g.id?z:void 0,b=g.x*N,k=g.y*N,I=(g.fontSize??16)*N,O=g.width?g.width*N:void 0,Y=(g.padding??0)*N,H=(g.letterSpacing??0)*N;return o.jsx(Ot,{ref:m,draggable:!0,x:b,y:k,text:g.text,fontFamily:g.fontFamily||"Georgia, serif",fontSize:I,fontStyle:g.fontStyle,fill:g.fill,width:O,align:g.align,lineHeight:g.lineHeight??1.25,padding:Y,letterSpacing:H,rotation:g.rotation,scaleX:1,scaleY:1,visible:g.visible,perfectDrawEnabled:!1,onTransform:V=>{const E=V.target,G=typeof E.scaleX=="function"?E.scaleX():1,B=typeof E.width=="function"?E.width():void 0;B!==void 0&&G&&G!==1&&(E.width(Math.max(4,Math.round(B*G))),typeof E.scaleX=="function"&&E.scaleX(1),typeof E.scaleY=="function"&&E.scaleY(1),E.getLayer()?.batchDraw())},onMouseDown:()=>n(g.id),onTap:()=>n(g.id),onDragEnd:V=>{j(r,g.id,{x:V.target.x()/N,y:V.target.y()/N})},onTransformEnd:V=>{const E=V.target,G=typeof E.scaleX=="function"?E.scaleX():1,B=typeof E.width=="function"?E.width():void 0,W={x:E.x()/N,y:E.y()/N,rotation:E.rotation(),scaleX:1,scaleY:1,width:B!==void 0?Math.max(4,Math.round(B*G/N)):void 0};typeof E.scaleX=="function"&&E.scaleX(1),typeof E.scaleY=="function"&&E.scaleY(1),j(r,g.id,W)}},g.id)}),s&&o.jsx(Vt,{ref:v,rotateEnabled:!0,enabledAnchors:["middle-left","middle-right","top-center","bottom-center","top-left","top-right","bottom-left","bottom-right"],borderStroke:"#fff",anchorStroke:"#fff",anchorFill:"#111",anchorSize:7,keepRatio:!1,centeredScaling:!1,boundBoxFunc:(u,g)=>{const m=Math.max(6,g.width),b=Math.max(6,g.height);return{...g,width:m,height:b}}})]})})}),Cs=[];function Rs({open:e,onOpenChange:r,photo:t,canvasRef:s}){const n=L(m=>m.addTextLayer),a=L(m=>m.transforms[t.id]??Z),i=L(m=>m.setTransform),[l,c]=h.useState(a),[d,p]=h.useState(null),f=L(m=>m.updateLayer),x=L(m=>m.removeLayer),S=L(m=>m.bringToFront),j=L(m=>m.sendToBack),v=L(m=>m.layersByPhoto[t.id]??Cs,Object.is),z=h.useRef(null),N=s??z;h.useEffect(()=>{e&&c(a)},[e,a]);const M=h.useRef(null),[u,g]=h.useState(0),R=h.useCallback(()=>{const m=M.current;if(!m)return;const b=Math.round(m.clientWidth);b&&g(b)},[]);return h.useEffect(()=>{const m=M.current;if(!m)return;const b=new ResizeObserver(R);return b.observe(m),R(),()=>b.disconnect()},[R]),h.useEffect(()=>{e&&(requestAnimationFrame(R),setTimeout(R,50))},[e,R]),o.jsx(Et,{open:e,onOpenChange:r,children:o.jsxs(je,{"aria-describedby":void 0,className:"max-w-[min(96vw,52rem)] max-h-[96vh] p-2 overflow-hidden flex flex-col",onOpenAutoFocus:()=>{requestAnimationFrame(()=>setTimeout(R,50))},children:[o.jsxs(Ne,{className:"shrink-0",children:[o.jsx(Re,{children:"Edit card"}),o.jsx(Tt,{className:"sr-only",children:"Adjust zoom/position and edit text layers."})]}),o.jsx("div",{className:"flex-1 overflow-auto",children:o.jsxs("div",{className:"grid gap-4",children:[o.jsx("div",{className:"mx-auto w-full max-w-[min(86vw,70vh)] rounded-xl border border-border bg-muted/20",children:o.jsx("div",{className:"relative aspect-square overflow-hidden rounded-xl",ref:M,children:u>0&&o.jsx("div",{className:"absolute inset-0 pointer-events-auto z-0",children:o.jsx(It,{ref:N,photoId:t.id,size:u,selectedId:d,onSelect:p})})})}),d&&(()=>{const m=v.find(b=>b.id===d&&b.type==="text");return m?o.jsxs("div",{className:"mt-2 grid gap-2 rounded-md border p-2 bg-background/60",children:[o.jsx("label",{className:"text-xs opacity-70",children:"Text"}),o.jsx("textarea",{value:m.text,onChange:b=>f(t.id,m.id,{text:b.target.value}),rows:3,className:"resize-y w-full rounded border px-2 py-1 text-sm bg-background"}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[o.jsx("label",{className:"text-xs opacity-70",children:"Size"}),o.jsx("input",{type:"number",min:8,max:240,step:1,value:m.fontSize??36,onChange:b=>f(t.id,m.id,{fontSize:Number(b.target.value)}),className:"w-20 rounded border px-2 py-1 text-sm"}),o.jsx("button",{type:"button",className:`rounded border px-2 py-1 text-sm ${m.fontStyle?.includes("bold")?"bg-foreground/10":""}`,onClick:()=>{const b=m.fontStyle?.includes("bold"),I=`${m.fontStyle?.includes("italic")?"italic":""} ${b?"":"bold"}`.trim();f(t.id,m.id,{fontStyle:I})},children:"Bold"}),o.jsx("button",{type:"button",className:`rounded border px-2 py-1 text-sm ${m.fontStyle?.includes("italic")?"bg-foreground/10":""}`,onClick:()=>{const b=m.fontStyle?.includes("bold"),I=`${m.fontStyle?.includes("italic")?"":"italic"} ${b?"bold":""}`.trim();f(t.id,m.id,{fontStyle:I})},children:"Italic"}),o.jsx("label",{className:"text-xs opacity-70 ml-2",children:"Color"}),o.jsx("input",{type:"color",value:m.fill??"#111111",onChange:b=>f(t.id,m.id,{fill:b.target.value}),className:"h-8 w-10 cursor-pointer"})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[o.jsx("label",{className:"text-xs opacity-70",children:"Font"}),o.jsx("select",{value:m.fontFamily??"Georgia, serif",onChange:async b=>{const k=b.target.value;await St(k),f(t.id,m.id,{fontFamily:k})},className:"rounded border px-2 py-1 text-sm",children:xt.map(b=>o.jsx("option",{value:b.family,children:b.label},b.id))})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[o.jsx("label",{className:"text-xs opacity-70",children:"Align"}),["left","center","right"].map(b=>o.jsx("button",{type:"button",className:`rounded border px-2 py-1 text-sm ${m.align===b?"bg-foreground/10":""}`,onClick:()=>f(t.id,m.id,{align:b}),children:b},b)),o.jsx("label",{className:"text-xs opacity-70 ml-2",children:"Wrap width"}),o.jsx("input",{type:"number",min:0,max:_,step:10,value:m.width??0,onChange:b=>f(t.id,m.id,{width:Number(b.target.value)||void 0}),className:"w-24 rounded border px-2 py-1 text-sm",title:"0 disables wrapping"}),o.jsx("label",{className:"text-xs opacity-70 ml-2",children:"Padding"}),o.jsx("input",{type:"number",min:0,max:200,step:1,value:m.padding??0,onChange:b=>f(t.id,m.id,{padding:Number(b.target.value)}),className:"w-20 rounded border px-2 py-1 text-sm"}),o.jsx("label",{className:"text-xs opacity-70 ml-2",children:"Line height"}),o.jsx("input",{type:"number",min:.8,max:2,step:.05,value:m.lineHeight??1.25,onChange:b=>f(t.id,m.id,{lineHeight:Number(b.target.value)}),className:"w-24 rounded border px-2 py-1 text-sm"}),o.jsx("label",{className:"text-xs opacity-70 ml-2",children:"Tracking"}),o.jsx("input",{type:"number",min:-5,max:20,step:.5,value:m.letterSpacing??0,onChange:b=>f(t.id,m.id,{letterSpacing:Number(b.target.value)}),className:"w-24 rounded border px-2 py-1 text-sm",title:"Additional spacing between glyphs (px, card space)"})]})]}):null})(),o.jsx("div",{className:"mx-auto w-full max-w-[min(86vw,70vh)]",children:o.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:[o.jsx(D,{variant:"secondary",disabled:!d,onClick:()=>{if(!d)return;const b=(L.getState().layersByPhoto[t.id]??[]).find(O=>O.id===d);if(!b)return;const I=((b.rotation??0)-90)%360;f(t.id,d,{rotation:I<0?I+360:I})},children:"Rotate −90°"}),o.jsx(D,{variant:"secondary",disabled:!d,onClick:()=>{if(!d)return;const b=(L.getState().layersByPhoto[t.id]??[]).find(O=>O.id===d);if(!b)return;const I=((b.rotation??0)+90)%360;f(t.id,d,{rotation:I})},children:"Rotate +90°"}),o.jsx(D,{variant:"secondary",disabled:!d,onClick:()=>d&&S(t.id,d),children:"Bring to front"}),o.jsx(D,{variant:"secondary",disabled:!d,onClick:()=>d&&j(t.id,d),children:"Send to back"}),o.jsx(D,{variant:"destructive",disabled:!d,onClick:()=>{d&&(x(t.id,d),p(null))},children:"Delete layer"})]})}),o.jsx("div",{className:"mx-auto w-full max-w-[min(86vw,70vh)]",children:o.jsxs("div",{className:"grid gap-3",children:[o.jsxs("div",{className:"grid gap-1.5",children:[o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsx(ce,{children:"Zoom"}),o.jsxs("span",{className:"tabular-nums opacity-70",children:[l.scale.toFixed(2),"×"]})]}),o.jsx(de,{value:[l.scale],min:1,max:3,step:.01,onValueChange:([m])=>c(b=>({...b,scale:m}))})]}),o.jsxs("div",{className:"grid gap-1.5",children:[o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsx(ce,{children:"Horizontal"}),o.jsxs("span",{className:"tabular-nums opacity-70",children:[l.tx.toFixed(0),"%"]})]}),o.jsx(de,{value:[l.tx],min:-100,max:100,step:.1,onValueChange:([m])=>c(b=>({...b,tx:m}))})]}),o.jsxs("div",{className:"grid gap-1.5",children:[o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsx(ce,{children:"Vertical"}),o.jsxs("span",{className:"tabular-nums opacity-70",children:[l.ty.toFixed(0),"%"]})]}),o.jsx(de,{value:[l.ty],min:-100,max:100,step:.1,onValueChange:([m])=>c(b=>({...b,ty:m}))})]})]})})]})}),o.jsxs(Ce,{className:"shrink-0 space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsx(D,{variant:"ghost",onClick:()=>c(Z),children:"Reset image"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(D,{variant:"secondary",onClick:()=>r(!1),children:"Cancel"}),o.jsx(D,{onClick:()=>{i(t.id,l),r(!1)},children:"Save"})]})]}),o.jsx("div",{children:o.jsx(D,{variant:"secondary",onClick:()=>{const m=n(t.id,{text:"New text",fontSize:48,fontFamily:"Georgia, serif",fill:"#fff",x:40,y:40,align:"left"});p(m)},children:"Add text layer"})})]})]})})}function Ss(e,r="card"){return(e.replace(/\.[^.]+$/,"").replace(/[^a-z0-9_\-]+/gi,"_").replace(/^_+|_+$/g,"")||r).slice(0,100)}function Ps(e,r){const t=document.createElement("a");t.href=e,t.download=r,document.body.appendChild(t),t.click(),t.remove()}function zs({open:e,onOpenChange:r,photo:t,transform:s,layers:n,snapshot:a,onEdit:i}){const[l,c]=h.useState(null),[d,p]=h.useState(!1),f=h.useRef(null),[x,S]=h.useState(0);h.useEffect(()=>{const u=f.current;if(!u)return;const g=()=>S(Math.round(u.clientWidth));g();const R=new ResizeObserver(g);return R.observe(u),()=>R.disconnect()},[]);const j=h.useRef(null),[v,z]=h.useState(le),N=h.useMemo(()=>e?o.jsx("div",{"aria-hidden":!0,style:{position:"fixed",left:-1e4,top:-1e4,width:v,height:v,overflow:"hidden"},children:o.jsx(It,{ref:j,photoId:t.id,size:v,selectedId:null,onSelect:()=>{}})}):null,[e,t.id,v]);async function M(u){z(u),await new Promise(R=>setTimeout(R,0));try{const R=document;R?.fonts?.ready&&typeof R.fonts.ready.then=="function"&&await R.fonts.ready}catch{}const g=Date.now()+1e3;for(;!j.current?.isReady?.()&&!(Date.now()>g);)await new Promise(R=>setTimeout(R,30));return j.current?.toDataURL(u)??null}return h.useEffect(()=>{let u=!1;if(!e){c(null);return}return(async()=>{p(!0);const g=Math.max(le,x||le);let R=null;a&&(R=a(g)),R||(R=await M(g)),!u&&(c(R),p(!1))})(),()=>{u=!0}},[e,x,t.id,s.scale,s.tx,s.ty,n,a]),o.jsxs(Et,{open:e,onOpenChange:r,children:[N,o.jsxs(je,{"aria-describedby":void 0,className:"max-w-[min(96vw,52rem)] max-h-[96vh] p-2 overflow-hidden",children:[o.jsx(Ne,{children:o.jsx(ir,{asChild:!0,children:o.jsx(Re,{children:"Preview"})})}),o.jsx("div",{className:"mx-auto w-full max-w-[min(86vw,70vh)] rounded-xl border border-border bg-muted/20",children:o.jsxs("div",{ref:f,className:"relative aspect-square overflow-hidden rounded-xl",children:[l?o.jsx("img",{src:l,alt:t.name,className:"absolute inset-0 w-full h-full object-contain"}):o.jsx("div",{className:"h-24"}),o.jsx("div",{className:`pointer-events-none absolute inset-0 grid place-items-center transition-opacity ${d?"opacity-100":"opacity-0"} bg-background/80 backdrop-blur-[2px]`,"aria-hidden":!d,children:o.jsx("div",{className:"h-7 w-7 animate-spin rounded-full border-2 border-foreground/40 border-t-transparent"})})]})}),o.jsxs(Ce,{className:"mt-2 gap-2",children:[o.jsx(D,{variant:"secondary",onClick:()=>{r(!1),i?.()},children:"Edit"}),o.jsx(D,{variant:"secondary",onClick:()=>r(!1),children:"Close"}),o.jsx(D,{onClick:async()=>{const u=a&&a(_)||await M(_);u&&Ps(u,`${Ss(t.name||"card")}.png`)},children:"Save PNG"})]})]})]})}function Ms({photo:e}){const r=L(u=>u.remove),t=L(u=>u.transforms[e.id]??Z),s=L(u=>u.layersByPhoto),[n,a]=h.useState(!1),[i,l]=h.useState(!1),c=h.useRef(null),d=h.useRef(null),[p,f]=h.useState(0);h.useEffect(()=>{const u=d.current;if(!u)return;const g=()=>f(u.clientWidth);g();const R=new ResizeObserver(g);return R.observe(u),()=>R.disconnect()},[]);const[x,S]=h.useState(null),[j,v]=h.useState(!0),z=h.useRef(0),N=h.useRef(null);h.useEffect(()=>{if(n)return;let u=!1,g=null;const R=++z.current;return N.current&&window.clearTimeout(N.current),N.current=window.setTimeout(async()=>{if(!p)return;v(!0);const m=window.devicePixelRatio||1,b=Math.max(384,Math.min(1024,Math.round(p*m))),k=await bs(e,"",{size:b,transform:t,layers:s[e.id]});if(u||z.current!==R){URL.revokeObjectURL(k);return}g&&URL.revokeObjectURL(g),S(k),g=k,v(!1)},200),()=>{u=!0,g&&URL.revokeObjectURL(g),N.current&&(window.clearTimeout(N.current),N.current=null)}},[p,e.url,t.scale,t.tx,t.ty,s[e.id],n]);const M=h.useCallback(async()=>{await ys(e,"",{size:_,transform:t,layers:s[e.id]})},[e,t,s]);return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"overflow-hidden rounded-xl border border-foreground/15 bg-foreground/[0.02]",children:[o.jsxs("div",{ref:d,onClick:()=>l(!0),className:"relative aspect-square w-full overflow-hidden cursor-zoom-in",children:[o.jsx("button",{"aria-label":"Remove image",title:"Remove",onClick:u=>{u.stopPropagation(),r(e.id)},className:"absolute right-1 top-1 z-10 rounded-md bg-background/80 px-1.5 py-0.5 text-[11px] shadow hover:bg-background",children:"×"}),x?o.jsx("img",{src:x,alt:e.name,className:"h-full w-full object-cover"}):o.jsx("div",{className:"h-full w-full bg-foreground/[0.06]"}),o.jsx("div",{className:`pointer-events-none absolute inset-0 grid place-items-center transition-opacity ${j?"opacity-100":"opacity-0"} bg-background/80 backdrop-blur-[2px]`,"aria-hidden":!j,children:o.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-2 border-foreground/40 border-t-transparent"})})]}),o.jsxs("div",{className:"flex items-center justify-between gap-2 border-t bg-background/70 px-2 py-1.5 supports-[backdrop-filter]:bg-background/60",children:[o.jsx("button",{"aria-label":"Edit card",title:"Edit",onClick:u=>{u.stopPropagation(),a(!0)},className:"rounded-md bg-background/80 px-2 py-1 text-[12px] shadow hover:bg-background",children:"Edit"}),o.jsx("button",{"aria-label":"Save PNG",title:"Save PNG",onClick:u=>{u.stopPropagation(),M()},className:"rounded-md bg-background/80 px-2 py-1 text-[12px] shadow hover:bg-background",children:"Save PNG"})]})]}),o.jsx(zs,{open:i,onOpenChange:l,photo:e,transform:t,layers:s[e.id],snapshot:u=>c.current?.toDataURL(u)??null,onEdit:()=>a(!0)}),o.jsx(Rs,{open:n,onOpenChange:a,photo:e,canvasRef:c})]})}function _e(e){const r=e/1e3;return r<60?`${r.toFixed(1)}s`:`${Math.floor(r/60)}m ${(r%60).toFixed(0)}s`}function Es(){const e=L(v=>v.photos),r=L(v=>v.transforms),t=L(v=>v.layersByPhoto),[s,n]=h.useState(!1),[a,i]=h.useState(null),l=h.useRef(!1),[c,d]=h.useState("jpeg"),[p,f]=h.useState(qr*100),x=a?.pct??0,S=h.useMemo(()=>{if(!a)return"";const v=a.etaMs??0;return`Rendering ${a.done}/${a.total} • ${x}% • elapsed ${_e(a.elapsedMs)}${a.done<a.total?` • ETA ${_e(v)}`:""}`},[a,x]);h.useEffect(()=>{a&&a.done>=a.total&&i(null)},[a]);const j=h.useCallback(async()=>{if(!(!e.length||l.current)){l.current=!0;try{n(!0),i({done:0,total:e.length,elapsedMs:0,pct:0});const{exportCardsToPdf:v}=await os(async()=>{const{exportCardsToPdf:z}=await import("./pdf-BXeXHJNn.js");return{exportCardsToPdf:z}},__vite__mapDeps([0,1,2,3]));await v(e,void 0,r,{size:_,format:c,quality:Math.min(.95,Math.max(.5,p/100)),onProgress:z=>i(z)},t)}finally{n(!1),l.current=!1}}},[e,r,c,p,t]);return o.jsxs("section",{className:"space-y-3",children:[o.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:e.map(v=>o.jsx(Ms,{photo:v},v.id))}),e.length>0&&o.jsxs(wt,{className:"p-4",children:[o.jsx("div",{className:"mb-3 text-sm font-medium",children:"Export the collection to PDF"}),a&&o.jsxs(o.Fragment,{children:[o.jsx(vt,{value:x,className:"mb-1 h-2"}),o.jsx("div",{className:"mb-3 text-xs opacity-70",children:S})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"opacity-70",children:"Format"}),o.jsxs(ds,{value:c,onValueChange:v=>d(v),children:[o.jsx(kt,{className:"w-28 h-8",children:o.jsx(us,{placeholder:"Format"})}),o.jsxs(Ct,{children:[o.jsx(ve,{value:"jpeg",children:"JPEG (small)"}),o.jsx(ve,{value:"png",children:"PNG (lossless)"})]})]})]}),c==="jpeg"&&o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"opacity-70",children:"Quality"}),o.jsx("input",{type:"range",min:50,max:95,step:5,value:p,onChange:v=>f(Number(v.target.value))}),o.jsxs("span",{className:"tabular-nums",children:[p,"%"]})]}),o.jsx("div",{className:"grow"}),o.jsx(D,{type:"button",size:"sm",onClick:j,disabled:!e.length||s,children:s?"Exporting…":"Export PDF"})]})]})]})}function Ls(){return lr(),o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"sticky top-0 z-10 w-full py-3 text-center text-3xl font-bold bg-background border-b border-gray-300",children:"Story Squares v1.0"}),o.jsxs("main",{className:"mx-auto max-w-screen-md px-4 space-y-5",children:[o.jsx(ts,{}),o.jsx(Es,{})]})]})}Ht.createRoot(document.getElementById("root")).render(o.jsx(h.StrictMode,{children:o.jsx(Ls,{})}));export{_ as C,Z as D,qr as P,Rt as d,Pt as e};
